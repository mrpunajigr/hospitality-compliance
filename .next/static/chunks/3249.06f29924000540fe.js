(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3249],{3249:(e,t,r)=>{"use strict";r.d(t,{getAuthenticationCore:()=>S});var i=r(9087),n=r(9509);class s extends i.EventEmitter{get isLoaded(){return this._isLoaded}get isActive(){return this._isActive}get isConfigured(){return this._isConfigured}get lastError(){return this._lastError}async configure(e){try{let t=this.validateConfiguration(e);if(!t.isValid)throw Error("Configuration validation failed: ".concat(t.errors.map(e=>e.message).join(", ")));this._configuration={...this._configuration,...e},await this.applyConfiguration(this._configuration),this._isConfigured=!0,this.updateActivity(),this.emit("configured",{configuration:this._configuration})}catch(e){throw this._lastError=e instanceof Error?e:Error(String(e)),this.emit("configuration-error",e),e}}getConfiguration(){return{...this._configuration}}validateConfiguration(e){let t=[],r=[];for(let r of this.manifest.configuration.required)r in e||t.push({field:r,message:"Required field '".concat(r,"' is missing"),code:"REQUIRED_FIELD_MISSING"});for(let[i,n]of Object.entries(this.manifest.configuration.schema))if(i in e){let s=e[i],a=this.validateField(i,s,n);t.push(...a.errors),r.push(...a.warnings||[])}let i=this.customConfigurationValidation(e);return t.push(...i.errors),r.push(...i.warnings||[]),{isValid:0===t.length,errors:t,warnings:r}}async initialize(){try{this.emit("initializing"),await this.onInitialize(),this._isLoaded=!0,this.updateActivity(),this.updateHealthStatus(),this.emit("initialized")}catch(e){throw this._lastError=e instanceof Error?e:Error(String(e)),this.emit("initialization-error",e),e}}async activate(){try{if(!this._isLoaded)throw Error("Module must be initialized before activation");this.emit("activating"),await this.onActivate(),this._isActive=!0,this.updateActivity(),this.updateHealthStatus(),this.emit("activated")}catch(e){throw this._lastError=e instanceof Error?e:Error(String(e)),this.emit("activation-error",e),e}}async deactivate(){try{if(!this._isActive)return;this.emit("deactivating"),await this.onDeactivate(),this._isActive=!1,this.updateActivity(),this.updateHealthStatus(),this.emit("deactivated")}catch(e){throw this._lastError=e instanceof Error?e:Error(String(e)),this.emit("deactivation-error",e),e}}async cleanup(){try{this.emit("cleaning-up"),this._isActive&&await this.deactivate(),await this.onCleanup(),this._isLoaded=!1,this._isConfigured=!1,this.updateActivity(),this.emit("cleaned-up")}catch(e){throw this._lastError=e instanceof Error?e:Error(String(e)),this.emit("cleanup-error",e),e}}getCapabilities(){return[...this.manifest.provides]}hasCapability(e,t){let r=this.manifest.provides.find(t=>t.name===e);return!!r&&(!t||this.isVersionCompatible(r.version,t))}getCapabilityInterface(e){if(!this.manifest.provides.find(t=>t.name===e))throw Error("Capability '".concat(e,"' not provided by this module"));if(!this._isActive)throw Error("Module must be active to access capability '".concat(e,"'"));return this.getCapabilityImplementation(e)}getHealthStatus(){return this.updateHealthStatus(),{...this._healthStatus}}getMetrics(){return this.updateMetrics(),{...this._metrics}}getLastActivity(){return new Date(this._lastActivity)}customConfigurationValidation(e){return{isValid:!0,errors:[]}}updateCustomMetrics(){return{}}performHealthCheck(){return[]}recordRequest(e){this._metrics.requestCount++;let t=this._metrics.avgResponseTime*(this._metrics.requestCount-1)+e;this._metrics.avgResponseTime=t/this._metrics.requestCount,this.updateActivity()}recordError(e){this._metrics.errorCount++,this._lastError=e,this.updateActivity(),this._healthStatus.issues.push({severity:"medium",message:e.message,code:"MODULE_ERROR",timestamp:new Date,resolved:!1}),this.emit("error",e)}logActivity(e,t){this.updateActivity(),this.emit("activity",{message:e,data:t,timestamp:new Date})}updateActivity(){this._lastActivity=new Date}updateMetrics(){void 0!==n&&n.memoryUsage&&(this._metrics.memoryUsage=n.memoryUsage().heapUsed),this._metrics.customMetrics=this.updateCustomMetrics()}updateHealthStatus(){let e=new Date;this._healthStatus.uptime=e.getTime()-this._startTime.getTime(),this._healthStatus.lastCheck=e;let t=this.performHealthCheck();this._healthStatus.issues.push(...t);let r=this._healthStatus.issues.filter(e=>"critical"===e.severity&&!e.resolved),i=this._healthStatus.issues.filter(e=>"high"===e.severity&&!e.resolved);r.length>0?this._healthStatus.status="unhealthy":i.length>0?this._healthStatus.status="degraded":this._isActive&&this._isLoaded?this._healthStatus.status="healthy":this._healthStatus.status="unknown";let n=new Date(e.getTime()-864e5);this._healthStatus.issues=this._healthStatus.issues.filter(e=>!e.resolved||e.timestamp>n)}validateField(e,t,r){let i=[];return"string"===r.type&&"string"!=typeof t?i.push({field:e,message:"Field '".concat(e,"' must be a string"),code:"INVALID_TYPE",value:t}):"number"===r.type&&"number"!=typeof t?i.push({field:e,message:"Field '".concat(e,"' must be a number"),code:"INVALID_TYPE",value:t}):"boolean"===r.type&&"boolean"!=typeof t&&i.push({field:e,message:"Field '".concat(e,"' must be a boolean"),code:"INVALID_TYPE",value:t}),r.enum&&!r.enum.includes(t)&&i.push({field:e,message:"Field '".concat(e,"' must be one of: ").concat(r.enum.join(", ")),code:"INVALID_ENUM_VALUE",value:t}),{isValid:0===i.length,errors:i,warnings:[]}}isVersionCompatible(e,t){let r=e.split(".").map(Number),i=t.split(".").map(Number);return r[0]===i[0]}constructor(e){super(),this._isLoaded=!1,this._isActive=!1,this._isConfigured=!1,this._configuration={},this.manifest=e,this._lastActivity=new Date,this._startTime=new Date,this._metrics={requestCount:0,errorCount:0,avgResponseTime:0,memoryUsage:0,customMetrics:{}},this._healthStatus={status:"unknown",lastCheck:new Date,issues:[],uptime:0},this._configuration={...this.manifest.configuration.defaults}}}var a=r(1811);let o={UPLOAD_DOCUMENTS:"upload_documents",VIEW_ALL_DOCUMENTS:"view_all_documents",DELETE_DOCUMENTS:"delete_documents",VIEW_COMPLIANCE_REPORTS:"view_compliance_reports",GENERATE_REPORTS:"generate_reports",ACKNOWLEDGE_ALERTS:"acknowledge_alerts",INVITE_USERS:"invite_users",MANAGE_USER_ROLES:"manage_user_roles",REMOVE_USERS:"remove_users",MANAGE_SUPPLIERS:"manage_suppliers",MANAGE_SETTINGS:"manage_settings",VIEW_AUDIT_LOGS:"view_audit_logs",MANAGE_BILLING:"manage_billing",EXPORT_DATA:"export_data",GRANT_INSPECTOR_ACCESS:"grant_inspector_access"},c=async()=>{let{data:{user:e},error:t}=await a.supabase.auth.getUser();return t||!e?null:e},u=async()=>{let e=await c();if(!e)return null;let{data:t,error:r}=await a.supabase.from("profiles").select("\n      *,\n      client_users (\n        *,\n        clients (*)\n      )\n    ").eq("id",e.id).single();return r?(console.error("Error fetching user profile:",r),null):t},l=async()=>!!await c(),h=async e=>{let t=await c();return t?await (0,a.tB)(t.id,e):null},d=async(e,t)=>{let r=await h(e);return!!r&&f(r,t)},f=(e,t)=>{let r={staff:1,manager:2,admin:3,owner:4};return r[e]>=r[t]},m=e=>({staff:[o.UPLOAD_DOCUMENTS],manager:[o.UPLOAD_DOCUMENTS,o.VIEW_ALL_DOCUMENTS,o.VIEW_COMPLIANCE_REPORTS,o.ACKNOWLEDGE_ALERTS,o.MANAGE_SUPPLIERS],admin:[o.UPLOAD_DOCUMENTS,o.VIEW_ALL_DOCUMENTS,o.DELETE_DOCUMENTS,o.VIEW_COMPLIANCE_REPORTS,o.GENERATE_REPORTS,o.ACKNOWLEDGE_ALERTS,o.INVITE_USERS,o.MANAGE_USER_ROLES,o.MANAGE_SUPPLIERS,o.MANAGE_SETTINGS,o.VIEW_AUDIT_LOGS,o.EXPORT_DATA,o.GRANT_INSPECTOR_ACCESS],owner:[o.UPLOAD_DOCUMENTS,o.VIEW_ALL_DOCUMENTS,o.DELETE_DOCUMENTS,o.VIEW_COMPLIANCE_REPORTS,o.GENERATE_REPORTS,o.ACKNOWLEDGE_ALERTS,o.INVITE_USERS,o.MANAGE_USER_ROLES,o.REMOVE_USERS,o.MANAGE_SUPPLIERS,o.MANAGE_SETTINGS,o.VIEW_AUDIT_LOGS,o.MANAGE_BILLING,o.EXPORT_DATA,o.GRANT_INSPECTOR_ACCESS]})[e]||[],p=async(e,t)=>{let r=await h(e);return!!r&&m(r).includes(t)},v=async(e,t)=>{let{data:r,error:i}=await a.supabase.auth.signInWithPassword({email:e,password:t});if(i)throw Error(i.message);return r},E=async(e,t,r)=>{let{data:i,error:n}=await a.supabase.auth.signUp({email:e,password:t,options:{data:{invitation_token:r}}});if(n)throw Error(n.message);return i},g=async()=>{let{error:e}=await a.supabase.auth.signOut();if(e)throw Error(e.message)},_=async(e,t,r)=>{let{data:i,error:n}=await a.supabase.from("profiles").insert({id:e,email:t,full_name:r}).select().single();if(n)throw Error("Failed to create profile: ".concat(n.message));return i},y=async e=>{let t=await c();if(!t)throw Error("No authenticated user");let{data:r,error:i}=await a.supabase.from("profiles").update(e).eq("id",t.id).select().single();if(i)throw Error("Failed to update profile: ".concat(i.message));return r},A=async(e,t)=>{let{data:r,error:i}=await a.supabase.from("invitations").select("*, clients(*)").eq("token",e).eq("status","pending").gt("expires_at",new Date().toISOString()).single();if(i||!r)throw Error("Invalid or expired invitation");let{data:n,error:s}=await a.supabase.auth.signUp({email:r.email,password:t});if(s||!n.user)throw Error("Signup failed: ".concat(null==s?void 0:s.message));await _(n.user.id,r.email);let{error:o}=await a.supabase.from("client_users").insert({user_id:n.user.id,client_id:r.client_id,role:r.role,status:"active",invited_by:r.invited_by,invited_at:r.created_at,joined_at:new Date().toISOString()});if(o)throw Error("Failed to create team membership: ".concat(o.message));return await a.supabase.from("invitations").update({status:"accepted"}).eq("id",r.id),{user:n.user,client:r.clients,role:r.role}};class w extends s{async onInitialize(){this.logActivity("Initializing Authentication Core module");try{await l(),this.logActivity("Authentication system connectivity verified")}catch(e){throw this.recordError(e instanceof Error?e:Error("Authentication system unavailable")),e}}async onActivate(){this.logActivity("Activating Authentication Core module"),this.setupEventListeners(),this.logActivity("Authentication Core module activated successfully")}async onDeactivate(){this.logActivity("Deactivating Authentication Core module"),this.removeAllListeners(),this.logActivity("Authentication Core module deactivated")}async onCleanup(){this.logActivity("Cleaning up Authentication Core module"),this.logActivity("Authentication Core module cleanup completed")}async applyConfiguration(e){this.config={...this.config,...e},this.logActivity("Authentication configuration updated",{config:this.config})}getCapabilityImplementation(e){switch(e){case"authentication":return this.getAuthenticationCapability();case"authorization":return this.getAuthorizationCapability();case"profile-management":return this.getProfileManagementCapability();case"team-management":return this.getTeamManagementCapability();default:throw Error("Unknown capability: ".concat(e))}}getAuthenticationCapability(){var e=this;return{signIn:async function(t,r){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let i=Date.now();try{let n=await v(t,r),s={success:!0,user:n.user};return e.recordRequest(Date.now()-i),e.emit("user:signed-in",{user:n.user}),s}catch(t){return e.recordError(t instanceof Error?t:Error("Sign in failed")),{success:!1,error:t instanceof Error?t.message:"Sign in failed"}}},signOut:async e=>{try{await g(),this.emit("user:signed-out",{userId:e||"current"})}catch(e){throw this.recordError(e instanceof Error?e:Error("Sign out failed")),e}},signUp:async(e,t,r)=>{let i=Date.now();try{let n=await E(e,t,r);return this.recordRequest(Date.now()-i),{success:!0,user:n.user,requiresVerification:!n.session}}catch(e){return this.recordError(e instanceof Error?e:Error("Sign up failed")),{success:!1,error:e instanceof Error?e.message:"Sign up failed"}}},getCurrentUser:c,getCurrentUserProfile:u,refreshSession:async()=>!0,isAuthenticated:l}}getAuthorizationCapability(){return{hasPermission:async(e,t,r)=>{try{return await p(t,r)}catch(e){return this.recordError(e instanceof Error?e:Error("Permission check failed")),!1}},hasRoleOrHigher:async(e,t,r)=>{try{return await d(t,r)}catch(e){return this.recordError(e instanceof Error?e:Error("Role check failed")),!1}},getRolePermissions:m,assignUserRole:async(e,t,r,i)=>{try{return this.emit("user:role-changed",{userId:e,clientId:t,newRole:r,oldRole:"staff"}),!0}catch(e){return this.recordError(e instanceof Error?e:Error("Role assignment failed")),!1}},removeUserRole:async(e,t,r)=>{try{return this.emit("team:user-removed",{userId:e,clientId:t,removedBy:r}),!0}catch(e){return this.recordError(e instanceof Error?e:Error("Role removal failed")),!1}},grantClientAccess:async(e,t,r,i)=>{try{return this.emit("client:accessed",{userId:e,clientId:t}),!0}catch(e){return this.recordError(e instanceof Error?e:Error("Client access grant failed")),!1}},revokeClientAccess:async(e,t,r)=>{try{return this.emit("client:access-denied",{userId:e,clientId:t,reason:"Access revoked"}),!0}catch(e){return this.recordError(e instanceof Error?e:Error("Client access revocation failed")),!1}}}}getProfileManagementCapability(){return{createUserProfile:async(e,t,r)=>{try{let i=await _(e,t,r);return{id:i.id,email:i.email,full_name:i.full_name,phone:i.phone,avatar_url:i.avatar_url,clients:[],created_at:i.created_at}}catch(e){throw this.recordError(e instanceof Error?e:Error("Profile creation failed")),e}},updateUserProfile:async(e,t)=>{try{let r=await y(t);return this.emit("user:profile-updated",{userId:e,changes:t}),{id:r.id,email:r.email,full_name:r.full_name,phone:r.phone,avatar_url:r.avatar_url,clients:[],created_at:r.created_at}}catch(e){throw this.recordError(e instanceof Error?e:Error("Profile update failed")),e}},getUserProfile:async e=>{try{let e=await u();if(!e)return null;return{id:e.id,email:e.email,full_name:e.full_name,phone:e.phone,avatar_url:e.avatar_url,clients:[],created_at:e.created_at}}catch(e){return this.recordError(e instanceof Error?e:Error("Profile fetch failed")),null}},deleteUserProfile:async(e,t)=>{try{return!0}catch(e){return this.recordError(e instanceof Error?e:Error("Profile deletion failed")),!1}},updateAvatar:async(e,t)=>{try{return"avatar-url"}catch(e){throw this.recordError(e instanceof Error?e:Error("Avatar update failed")),e}},removeAvatar:async e=>{}}}getTeamManagementCapability(){return{createInvitation:async(e,t,r,i)=>{try{return this.emit("team:user-invited",{email:e,clientId:t,role:r,invitedBy:i}),{id:"invitation-id",email:e,role:r,token:"invitation-token",status:"pending",client_id:t,invited_by:i,expires_at:new Date(Date.now()+60*this.config.invitationExpiryHours*6e4).toISOString(),created_at:new Date().toISOString()}}catch(e){throw this.recordError(e instanceof Error?e:Error("Invitation creation failed")),e}},acceptInvitation:async(e,t)=>{try{let r=await A(e,t);return this.emit("team:invitation-accepted",{userId:r.user.id,clientId:r.client.id,role:r.role}),{success:!0,user:r.user,client:r.client,role:r.role}}catch(e){return this.recordError(e instanceof Error?e:Error("Invitation acceptance failed")),{success:!1,error:e instanceof Error?e.message:"Invitation acceptance failed"}}},cancelInvitation:async(e,t)=>{try{return!0}catch(e){return this.recordError(e instanceof Error?e:Error("Invitation cancellation failed")),!1}},getInvitations:async e=>{try{return[]}catch(e){return this.recordError(e instanceof Error?e:Error("Invitations fetch failed")),[]}},getTeamMembers:async e=>{try{return[]}catch(e){return this.recordError(e instanceof Error?e:Error("Team members fetch failed")),[]}},removeTeamMember:async(e,t,r)=>{try{return this.emit("team:user-removed",{userId:e,clientId:t,removedBy:r}),!0}catch(e){return this.recordError(e instanceof Error?e:Error("Team member removal failed")),!1}},updateTeamMemberRole:async(e,t,r,i)=>{try{return this.emit("user:role-changed",{userId:e,clientId:t,newRole:r,oldRole:"staff"}),!0}catch(e){return this.recordError(e instanceof Error?e:Error("Team member role update failed")),!1}}}}performHealthCheck(){let e=[];this.isActive||e.push({severity:"high",message:"Authentication module is not active",code:"MODULE_INACTIVE",timestamp:new Date,resolved:!1});let t=this.getMetrics();return t.requestCount>0&&t.errorCount/t.requestCount>.1&&e.push({severity:"medium",message:"High authentication error rate detected",code:"HIGH_ERROR_RATE",timestamp:new Date,resolved:!1}),e}updateCustomMetrics(){return{activeUsers:0,sessionsCreated:0,loginAttempts:0,failedLogins:0}}setupEventListeners(){this.logActivity("Authentication event listeners configured")}constructor(){let e={sessionTimeout:36e5,refreshTokenLifetime:2592e6,enableSessionRefresh:!0,passwordMinLength:8,passwordRequireUppercase:!0,passwordRequireLowercase:!0,passwordRequireNumbers:!0,passwordRequireSpecialChars:!1,passwordMaxAttempts:5,passwordLockoutDuration:9e5,enableMultipleClients:!0,defaultClientSelection:"first",enableClientSwitching:!0,invitationExpiryHours:72,enableSelfRegistration:!1,requireEmailVerification:!0,enableRememberMe:!0,rememberMeDuration:2592e6,enableIPWhitelisting:!1,enableDeviceTracking:!1,enableAuditLogging:!0,auditRetentionDays:90};super({name:"@jigr/authentication-core",version:"1.0.0",description:"Core authentication and authorization module for JiGR Suite",provides:[{name:"authentication",version:"1.0.0",description:"User authentication and session management",interface:"auth-interface"},{name:"authorization",version:"1.0.0",description:"Role-based access control and permissions",interface:"auth-interface"},{name:"profile-management",version:"1.0.0",description:"User profile and account management",interface:"auth-interface"},{name:"team-management",version:"1.0.0",description:"Team invitations and member management",interface:"auth-interface"}],requires:[{name:"@jigr/database-core",version:"^1.0.0",description:"Database abstraction layer",interface:"auth-interface"}],configuration:{required:["sessionTimeout","passwordMinLength"],defaults:e,schema:{sessionTimeout:{type:"number",description:"Session timeout in milliseconds"},passwordMinLength:{type:"number",description:"Minimum password length"},enableMultipleClients:{type:"boolean",description:"Enable multi-tenant client support"},invitationExpiryHours:{type:"number",description:"Invitation expiry time in hours"}}}}),this.config=e}}let C=null,S=()=>(C||(C=new w),C)},9087:e=>{!function(){"use strict";var t={864:function(e){var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var n=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise(function(r,i){var n,s,a;function o(r){e.removeListener(t,c),i(r)}function c(){"function"==typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}p(e,t,c,{once:!0}),"error"!==t&&(n=e,s=o,a={once:!0},"function"==typeof n.on&&p(n,"error",s,a))})},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,r,i){if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),(n=c(e))>0&&a.length>n&&!a.warned){a.warned=!0;var n,s,a,u=Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=l.bind(i);return n.listener=r,i.wrapFn=n,n}function d(e,t,r){var i=e._events;if(void 0===i)return[];var n=i[t];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):m(n,n.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function m(e,t){for(var r=Array(t),i=0;i<t;++i)r[i]=e[i];return r}function p(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function n(s){i.once&&e.removeEventListener(t,n),r(s)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||n(e))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n="error"===e,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var a,o=Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else for(var u=c.length,l=m(c,u),r=0;r<u;++r)i(l[r],this,t);return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,i,n,s,a;if(o(t),void 0===(i=this._events)||void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,n),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0==arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}}},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var s=r[e]={exports:{}},a=!0;try{t[e](s,s.exports,i),a=!1}finally{a&&delete r[e]}return s.exports}i.ab="//",e.exports=i(864)}()}}]);