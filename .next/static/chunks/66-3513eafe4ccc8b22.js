"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[66],{66:(e,s,t)=>{t.d(s,{A:()=>o});var r=t(5155),a=t(2115);class i{async preprocessForQualityAnalysis(e,s){let t=performance.now(),r={...this.defaultOptions,...s},a=e.size;if(!this.isSupportedByBrowser(e))return console.warn("Unsupported format: ".concat(e.type," (").concat(e.name,"). Browser cannot process HEIC/HEIF files.")),{processedFile:e,originalSize:a,processedSize:e.size,compressionRatio:1,resized:!1,converted:!1,processingTime:performance.now()-t};if(e.size<=r.maxFileSize&&this.isOptimalFormat(e))return{processedFile:e,originalSize:a,processedSize:e.size,compressionRatio:1,resized:!1,converted:!1,processingTime:performance.now()-t};try{let s=await this.processImage(e,r),i=performance.now()-t;return{processedFile:s,originalSize:a,processedSize:s.size,compressionRatio:a/s.size,resized:await this.wasResized(e,s),converted:e.type!==s.type,processingTime:i}}catch(s){return console.error("Image preprocessing failed:",s),{processedFile:e,originalSize:a,processedSize:e.size,compressionRatio:1,resized:!1,converted:!1,processingTime:performance.now()-t}}}async processImage(e,s){return new Promise((t,r)=>{let a=new Image,i=document.createElement("canvas"),n=i.getContext("2d");if(!n)return void r(Error("Could not get canvas context"));a.onload=()=>{try{let{width:l,height:o}=this.calculateOptimalDimensions(a.width,a.height,s.maxWidth,s.maxHeight);i.width=l,i.height=o,n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(a,0,0,l,o),i.toBlob(a=>{if(a){let r=new File([a],this.generateFileName(e,s.targetFormat),{type:"image/".concat(s.targetFormat),lastModified:Date.now()});t(r)}else r(Error("Failed to create processed image blob"))},"image/".concat(s.targetFormat),s.quality)}catch(e){r(e)}finally{URL.revokeObjectURL(a.src)}},a.onerror=e=>{URL.revokeObjectURL(a.src),r(Error("Failed to load image for processing"))},a.src=URL.createObjectURL(e)})}calculateOptimalDimensions(e,s,t,r){if(e<=t&&s<=r)return{width:e,height:s};let a=e/s,i=t,n=t/a;return n>r&&(n=r,i=r*a),{width:Math.round(i),height:Math.round(n)}}generateFileName(e,s){let t=e.name.replace(/\.[^/.]+$/,""),r=Date.now();return"".concat(t,"_processed_").concat(r,".").concat(s)}isOptimalFormat(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type.toLowerCase())}isSupportedByBrowser(e){return!["image/heic","image/heif"].includes(e.type.toLowerCase())&&!e.name.toLowerCase().endsWith(".heic")&&!e.name.toLowerCase().endsWith(".heif")}async wasResized(e,s){return s.size/e.size<.8}static formatFileSize(e){if(0===e)return"0 Bytes";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]}static estimateProcessingTime(e){return e<1048576?1e3:e<5242880?3e3:e<0xa00000?6e3:1e4}constructor(){this.defaultOptions={maxWidth:2048,maxHeight:2048,maxFileSize:5242880,quality:.85,targetFormat:"jpeg"}}}class n{async validateForOCR(e){try{let s,t=e;if((e.size>0xa00000||!this.isOptimalFormat(e))&&(console.log("Preprocessing ".concat(e.name," (").concat(i.formatFileSize(e.size),")")),t=(s=await this.preprocessor.preprocessForQualityAnalysis(e,{maxWidth:1920,maxHeight:1920,maxFileSize:5242880,quality:.85,targetFormat:"jpeg"})).processedFile,s.processedFile===e?console.log("File format not supported for preprocessing, analyzing original file"):console.log("Preprocessed to ".concat(i.formatFileSize(t.size)," in ").concat(s.processingTime.toFixed(0),"ms"))),!this.isSupportedByBrowser(t)){console.log("Cannot analyze ".concat(t.name," - unsupported format for quality analysis"));let r={brightness:50,contrast:50,sharpness:50,resolution:3e6,fileSize:e.size,aspectRatio:1.33},a=this.generateSuggestions(r,s,e),i=this.generateWarnings(r,s,e);return{acceptable:!0,score:50,metrics:r,suggestions:a,warnings:i,preprocessing:s}}let r=new Promise((e,s)=>{setTimeout(()=>s(Error("Quality analysis timeout")),8e3)}),a=await Promise.race([this.calculateMetrics(t),r]);s&&(a.fileSize=e.size);let n=this.generateSuggestions(a,s,e),l=this.generateWarnings(a,s,e),o=this.isAcceptableForOCR(a),c=this.calculateQualityScore(a);return{acceptable:o,score:c,metrics:a,suggestions:n,warnings:l,preprocessing:s}}catch(s){return console.error("Quality validation failed:",s),{acceptable:!0,score:50,metrics:{brightness:50,contrast:50,sharpness:50,resolution:0,fileSize:e.size,aspectRatio:1},suggestions:["Quality analysis failed - using fallback validation"],warnings:["Could not analyze image quality"]}}}async calculateMetrics(e){return new Promise((s,t)=>{let r=new Image,a=document.createElement("canvas"),i=a.getContext("2d");if(!i)return void t(Error("Could not get canvas context"));r.onload=()=>{try{a.width=r.width,a.height=r.height,i.drawImage(r,0,0);let t=i.getImageData(0,0,a.width,a.height);s({brightness:this.calculateBrightness(t),contrast:this.calculateContrast(t),sharpness:this.calculateSharpness(t),resolution:r.width*r.height,fileSize:e.size,aspectRatio:r.width/r.height})}catch(e){console.error("Error processing image:",e),t(e)}finally{URL.revokeObjectURL(r.src)}},r.onerror=e=>{console.error("Error loading image:",e),URL.revokeObjectURL(r.src),t(Error("Failed to load image"))},r.src=URL.createObjectURL(e)})}calculateBrightness(e){let s=e.data,t=0;for(let e=0;e<s.length;e+=4){let r=s[e];t+=(r+s[e+1]+s[e+2])/3}return t/(s.length/4)/255*100}calculateContrast(e){let s=e.data,t=255*this.calculateBrightness(e)/100,r=0,a=s.length/4;for(let e=0;e<s.length;e+=4){let a=s[e];r+=Math.pow((a+s[e+1]+s[e+2])/3-t,2)}return Math.min(Math.sqrt(r/a)/255*100,100)}calculateSharpness(e){let s=e.data,t=e.width,r=e.height,a=0,i=0,n=Math.max(1,Math.floor(Math.min(t,r)/100));for(let e=n;e<r-n;e+=n)for(let r=n;r<t-n;r+=n){let n=(e*t+r)*4,l=s[n],o=s[n+4];a+=Math.abs(l-o)+Math.abs(l-s[n+4*t]),i++}return 0===i?50:Math.min(a/i/255*100,100)}isOptimalFormat(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type.toLowerCase())}isSupportedByBrowser(e){let s=["image/heic","image/heif"].includes(e.type.toLowerCase()),t=e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif");return!s&&!t}isAcceptableForOCR(e){return e.brightness>=this.thresholds.brightness.min&&e.brightness<=this.thresholds.brightness.max&&e.contrast>=this.thresholds.contrast.min&&e.sharpness>=this.thresholds.sharpness.min&&e.resolution>=this.thresholds.resolution.min&&e.fileSize>=this.thresholds.fileSize.min&&e.fileSize<=this.thresholds.fileSize.max&&e.aspectRatio>=this.thresholds.aspectRatio.min&&e.aspectRatio<=this.thresholds.aspectRatio.max}calculateQualityScore(e){let s=0;return e.brightness>=40&&e.brightness<=80?s+=30:e.brightness>=30&&e.brightness<=85?s+=20:e.brightness>=20&&e.brightness<=90&&(s+=10),e.contrast>=40?s+=25:e.contrast>=25?s+=15:e.contrast>=15&&(s+=10),e.sharpness>=50?s+=25:e.sharpness>=35?s+=15:e.sharpness>=20&&(s+=10),e.resolution>=2073600?s+=20:e.resolution>=96e4?s+=15:e.resolution>=48e4&&(s+=10),Math.round(s)}generateSuggestions(e,s,t){let r=[];return s&&(s.processedFile===t&&t&&t.name.toLowerCase().includes(".heic")?(r.push("HEIC format detected - browser cannot process this format for quality analysis"),r.push("Consider converting to JPEG/PNG format for detailed quality feedback"),r.push("File will still be uploaded for OCR processing")):s.converted&&r.push("Converted from ".concat((null==t?void 0:t.type)||"original format"," to JPEG for better compatibility")),s.resized&&r.push("Resized image for faster processing (".concat(s.compressionRatio.toFixed(1),"x smaller)")),s.processingTime>3e3&&r.push("Large file detected - consider capturing smaller images for faster analysis")),e.brightness<30?r.push("Improve lighting - image is too dark for optimal OCR"):e.brightness>85&&r.push("Reduce lighting - image is too bright, may cause glare"),e.contrast<25&&r.push("Increase contrast between text and background"),e.sharpness<35&&r.push("Hold camera steady and ensure document is in focus"),e.resolution<96e4&&r.push("Move closer to document or use higher camera resolution"),e.fileSize<102400?r.push("Image quality too low - try capturing again"):e.fileSize>0x3200000?r.push("Very large file - consider using camera settings with lower resolution"):e.fileSize>0x1400000&&r.push("Large file size may slow down processing"),(e.aspectRatio<.5||e.aspectRatio>2)&&r.push("Document appears distorted - ensure proper framing"),r}generateWarnings(e,s,t){let r=[];return s&&(s.processedFile===t&&t&&t.name.toLowerCase().includes(".heic")&&r.push("HEIC format cannot be analyzed for quality - quality metrics are estimates"),s.compressionRatio>10&&r.push("Image was heavily compressed - some quality may be lost"),s.processingTime>5e3&&r.push("Large file required significant processing time")),(e.brightness<20||e.brightness>90)&&r.push("Extreme brightness levels may prevent text recognition"),e.contrast<15&&r.push("Very low contrast - text may be unreadable"),e.sharpness<20&&r.push("Image appears blurry - OCR accuracy will be poor"),e.resolution<48e4&&r.push("Resolution too low for reliable text extraction"),e.fileSize>0x6400000&&r.push("Extremely large file - may cause memory issues"),r}constructor(){this.preprocessor=new i,this.thresholds={brightness:{min:30,max:85},contrast:{min:25},sharpness:{min:35},resolution:{min:96e4},fileSize:{min:102400,max:8388608},aspectRatio:{min:.5,max:2}}}}function l(e){var s,t;let{qualityReport:a,isProcessing:i}=e;return i?(0,r.jsx)("div",{className:"bg-blue-500/20 border border-blue-400/30 rounded-xl p-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-blue-400 border-t-transparent rounded-full"}),(0,r.jsx)("p",{className:"text-blue-200 text-sm font-medium",children:"Analyzing image quality..."})]})}):a?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"rounded-xl p-4 border ".concat((s=a.score)>=80?"bg-green-500/20 border-green-400/30":s>=60?"bg-yellow-500/20 border-yellow-400/30":"bg-red-500/20 border-red-400/30"),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-white text-sm font-medium",children:"Image Quality"}),(0,r.jsxs)("span",{className:"text-lg font-bold ".concat((t=a.score)>=80?"text-green-400":t>=60?"text-yellow-400":"text-red-400"),children:[a.score,"%"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Brightness:"}),(0,r.jsxs)("span",{className:a.metrics.brightness>=30&&a.metrics.brightness<=85?"text-green-400":"text-yellow-400",children:[Math.round(a.metrics.brightness),"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Contrast:"}),(0,r.jsxs)("span",{className:a.metrics.contrast>=25?"text-green-400":"text-yellow-400",children:[Math.round(a.metrics.contrast),"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Sharpness:"}),(0,r.jsxs)("span",{className:a.metrics.sharpness>=35?"text-green-400":"text-yellow-400",children:[Math.round(a.metrics.sharpness),"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Resolution:"}),(0,r.jsx)("span",{className:a.metrics.resolution>=96e4?"text-green-400":"text-yellow-400",children:a.metrics.resolution>=1e6?"".concat((a.metrics.resolution/1e6).toFixed(1),"MP"):"".concat(Math.round(a.metrics.resolution/1e3),"K")})]})]})]}),a.preprocessing&&(0,r.jsxs)("div",{className:"bg-purple-500/20 border border-purple-400/30 rounded-xl p-4",children:[(0,r.jsx)("h4",{className:"text-purple-300 text-sm font-medium mb-2",children:"⚡ Processing Info:"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Original Size:"}),(0,r.jsxs)("span",{className:"text-purple-300",children:[(a.preprocessing.originalSize/1024/1024).toFixed(1)," MB"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Processed Size:"}),(0,r.jsxs)("span",{className:"text-purple-300",children:[(a.preprocessing.processedSize/1024/1024).toFixed(1)," MB"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Compression:"}),(0,r.jsxs)("span",{className:"text-purple-300",children:[a.preprocessing.compressionRatio.toFixed(1),"x"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-white/70",children:"Process Time:"}),(0,r.jsxs)("span",{className:"text-purple-300",children:[a.preprocessing.processingTime.toFixed(0),"ms"]})]})]})]}),a.suggestions.length>0&&(0,r.jsxs)("div",{className:"bg-blue-500/20 border border-blue-400/30 rounded-xl p-4",children:[(0,r.jsx)("h4",{className:"text-blue-300 text-sm font-medium mb-2",children:"\uD83D\uDCA1 Improvement Tips:"}),(0,r.jsx)("ul",{className:"space-y-1",children:a.suggestions.map((e,s)=>(0,r.jsxs)("li",{className:"text-blue-200 text-xs flex items-start space-x-2",children:[(0,r.jsx)("span",{className:"text-blue-400 mt-1",children:"•"}),(0,r.jsx)("span",{children:e})]},s))})]}),a.warnings.length>0&&(0,r.jsxs)("div",{className:"bg-red-500/20 border border-red-400/30 rounded-xl p-4",children:[(0,r.jsx)("h4",{className:"text-red-300 text-sm font-medium mb-2",children:"⚠️ Quality Warnings:"}),(0,r.jsx)("ul",{className:"space-y-1",children:a.warnings.map((e,s)=>(0,r.jsxs)("li",{className:"text-red-200 text-xs flex items-start space-x-2",children:[(0,r.jsx)("span",{className:"text-red-400 mt-1",children:"•"}),(0,r.jsx)("span",{children:e})]},s))})]}),(0,r.jsx)("div",{className:"rounded-xl p-3 border ".concat(a.acceptable?"bg-green-500/20 border-green-400/30":"bg-yellow-500/20 border-yellow-400/30"),children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:a.acceptable?"text-green-400":"text-yellow-400",children:a.acceptable?"✅":"⚠️"}),(0,r.jsx)("span",{className:"text-sm font-medium ".concat(a.acceptable?"text-green-300":"text-yellow-300"),children:a.acceptable?"Ready for OCR Processing":"May have OCR accuracy issues"})]})})]}):null}function o(e){let{onFileValidated:s,onFileRejected:t,allowPoorQuality:i=!1,className:o="",children:c}=e,[d,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(null),[u,g]=(0,a.useState)(null),x=(0,a.useRef)(null),b=(0,a.useMemo)(()=>new n,[]),f=(0,a.useCallback)(async e=>{if(!e.type.startsWith("image/"))return void alert("Please select an image file");g(e),h(!0),p(null);try{let r=await b.validateForOCR(e);p(r),r.acceptable||i?s(e,r):t(e,r)}catch(r){console.error("Quality validation failed:",r);let t={acceptable:!0,score:50,metrics:{brightness:50,contrast:50,sharpness:50,resolution:0,fileSize:e.size,aspectRatio:1},suggestions:["Quality validation failed - using fallback"],warnings:[]};p(t),s(e,t)}finally{h(!1)}},[b,s,t,i]),y=()=>{var e;null==(e=x.current)||e.click()},w=()=>{g(null),p(null),y()};return(0,r.jsxs)("div",{className:"space-y-4 ".concat(o),children:[(0,r.jsx)("input",{ref:x,type:"file",accept:"image/*",onChange:e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];t&&f(t)},className:"hidden"}),(0,r.jsx)("div",{onDrop:e=>{e.preventDefault();let s=e.dataTransfer.files[0];s&&f(s)},onDragOver:e=>{e.preventDefault()},onClick:y,className:"relative overflow-hidden p-8 rounded-3xl border-2 border-dashed border-white/30 hover:border-white/50 cursor-pointer transition-all duration-300 bg-white/5 hover:bg-white/10",children:c||(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-white/50",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,r.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Drop your image here or click to browse"}),(0,r.jsx)("p",{className:"text-sm text-white/70",children:"Supports JPG, PNG, WebP • Max 8MB"}),(0,r.jsx)("p",{className:"text-xs text-white/50 mt-2",children:"Images will be analyzed for OCR quality"})]})}),u&&(0,r.jsx)("div",{className:"bg-white/10 border border-white/20 rounded-xl p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"bg-blue-500/20 p-2 rounded-lg",children:(0,r.jsx)("svg",{className:"h-5 w-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-white text-sm font-medium",children:u.name}),(0,r.jsxs)("p",{className:"text-white/60 text-xs",children:[(u.size/1024/1024).toFixed(2)," MB"]})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>{u&&f(u)},disabled:d,className:"px-3 py-1 bg-blue-500/20 text-blue-300 text-xs rounded-lg hover:bg-blue-500/30 transition-colors disabled:opacity-50",children:"Reanalyze"}),(0,r.jsx)("button",{onClick:w,className:"px-3 py-1 bg-gray-500/20 text-gray-300 text-xs rounded-lg hover:bg-gray-500/30 transition-colors",children:"New File"})]})]})}),(0,r.jsx)(l,{qualityReport:m,isProcessing:d}),m&&!m.acceptable&&!i&&(0,r.jsx)("div",{className:"bg-yellow-500/20 border border-yellow-400/30 rounded-xl p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-yellow-300 text-sm font-medium",children:"Quality Below OCR Standards"}),(0,r.jsx)("p",{className:"text-yellow-200 text-xs",children:"This image may produce poor OCR results. Consider retaking for better accuracy."})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{onClick:()=>u&&s(u,m),className:"px-4 py-2 bg-yellow-500/30 text-yellow-200 text-sm rounded-lg hover:bg-yellow-500/40 transition-colors",children:"Use Anyway"}),(0,r.jsx)("button",{onClick:w,className:"px-4 py-2 bg-green-500/30 text-green-200 text-sm rounded-lg hover:bg-green-500/40 transition-colors",children:"Try Again"})]})]})})]})}}}]);