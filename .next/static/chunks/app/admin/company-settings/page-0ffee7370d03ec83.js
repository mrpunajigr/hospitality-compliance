(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[456],{1957:(e,s,t)=>{Promise.resolve().then(t.bind(t,4441))},4441:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var a=t(5155),n=t(2115),r=t(5695),i=t(1811),l=t(5552),o=t(9175),c=t(8337),d=t(2124),m=t(8765),u=t(2808);function h(){let[e,s]=(0,n.useState)(null),[t,h]=(0,n.useState)(null),[x,p]=(0,n.useState)(!0),[b,g]=(0,n.useState)(!1),[y,v]=(0,n.useState)(""),[j,f]=(0,n.useState)(!1),[_,N]=(0,n.useState)(!1),[w,C]=(0,n.useState)("background"),[S,k]=(0,n.useState)(""),[$,E]=(0,n.useState)([]),[D,P]=(0,n.useState)(!1),[A,R]=(0,n.useState)(!1),[T,U]=(0,n.useState)(!1),[L,B]=(0,n.useState)({name:"",business_type:"",business_email:"",phone:"",license_number:"",address:{street:"",city:"",region:"",postalCode:"",country:""},estimated_monthly_deliveries:50,results_card_config:u.P}),I=(0,r.useRouter)();(0,n.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t="true"===e.get("onboarding");e.get("company"),t&&(R(!0),U(!0)),(async()=>{let{data:{user:e}}=await i.supabase.auth.getUser();if(!e)return I.push("/signin");s(e);try{let s=await (0,l.LE)(e.id);s?(h(s),B({name:s.name||"",business_type:s.business_type||"",business_email:s.business_email||"",phone:s.phone||"",license_number:s.license_number||"",address:s.address||{street:"",city:"",region:"",postalCode:"",country:"NZ"},estimated_monthly_deliveries:s.estimated_monthly_deliveries||50,results_card_config:s.results_card_config||{show_supplier_name:!0,show_delivery_date:!0,show_confidence_score:!0,show_upload_info:!0,card_style:"modern"}})):v("No company found. User ID: ".concat(e.id,". Please check debug endpoint: /api/debug-user?userId=").concat(e.id))}catch(e){console.error("Error loading company data:",e),v("Error loading company information.")}p(!1)})(),M()},[I]);let M=async()=>{P(!0);try{let e=(null==t?void 0:t.id)||"",s=await fetch("/api/assets/upload?type=background&clientId=".concat(e)),a=await s.json();a.success&&(E(a.assets),a.assets.length>0&&!S&&k(a.assets[0].file_url))}catch(e){console.error("Error loading assets:",e)}P(!1)},O=e=>{let{name:s,value:t}=e.target;if(s.startsWith("address.")){let e=s.split(".")[1];B(s=>({...s,address:{...s.address,[e]:t}}))}else B(e=>({...e,[s]:"estimated_monthly_deliveries"===s?parseInt(t)||0:t}))},q=async s=>{if(s.preventDefault(),t){g(!0),v("");try{let s=await fetch("/api/update-company",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({companyId:t.id,userId:e.id,name:L.name,business_type:L.business_type,business_email:L.business_email,phone:L.phone,license_number:L.license_number,address:L.address,estimated_monthly_deliveries:L.estimated_monthly_deliveries})}),a=await s.json();if(s.ok){v("Company profile updated successfully!");let s=await (0,l.LE)(e.id);s&&h(s)}else console.error("Error updating company:",a),v("Error saving changes: ".concat(a.error))}catch(e){console.error("Error saving company settings:",e),v("Error saving changes. Please try again.")}g(!1)}};return x?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-blue-600 border-t-transparent rounded-full"})}):(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"".concat((0,c.$$)("pageTitle")," drop-shadow-lg"),children:"Settings"}),(0,a.jsx)("p",{className:"".concat((0,c.$$)("bodySmall")," drop-shadow-md"),children:"Manage your business information and preferences"}),t&&(0,a.jsxs)("div",{className:"".concat((0,c.$$)("meta")," text-white/80 drop-shadow-md mt-1"),children:[t.name," • ",t.role]})]}),A&&T&&(0,a.jsx)("div",{className:"".concat((0,c.ed)("primary")," mb-6 border-green-500/50"),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"".concat((0,c.$$)("sectionTitle")," text-green-400 mb-2"),children:"\uD83C\uDF89 Welcome! Your account has been created successfully!"}),(0,a.jsx)("p",{className:"".concat((0,c.$$)("body")," text-white/90 mb-4"),children:"Let's complete your company setup to get the most out of your hospitality compliance platform."}),(0,a.jsx)("div",{className:"".concat((0,c.$$)("meta")," text-white/70"),children:"✅ Account Created • \uD83D\uDCDD Complete Company Setup • \uD83D\uDE80 Ready to Use"})]}),(0,a.jsx)("button",{onClick:()=>U(!1),className:"text-white/60 hover:text-white/90 transition-colors",children:"✕"})]})})]})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"".concat((0,c.ed)("primary")," max-w-2xl mx-auto"),children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"".concat((0,c.$$)("sectionTitle")," text-gray-900 mb-2"),children:"Company Profile"}),(0,a.jsx)("p",{className:"".concat((0,c.$$)("body")," text-gray-600"),children:"Manage your company information and business details."})]}),y&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-xl ".concat(y.includes("Error")?"bg-red-50 border border-red-200 text-red-700":"bg-green-50 border border-green-200 text-green-700"),children:y}),(0,a.jsxs)("form",{onSubmit:q,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Name *"}),(0,a.jsx)("input",{type:"text",name:"name",value:L.name,onChange:O,required:!0,className:"".concat((0,c._c)()," bg-white")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company Avatar"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-gray-100 border-2 border-gray-200 flex items-center justify-center overflow-hidden",children:(0,a.jsx)("div",{className:"text-gray-400 text-2xl font-bold",children:L.name?L.name.charAt(0).toUpperCase():"C"})}),(0,a.jsx)("button",{type:"button",className:"absolute -bottom-1 -right-1 bg-blue-600 hover:bg-blue-700 text-white p-1.5 rounded-full shadow-sm transition-colors",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"Upload company profile picture"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Recommended: Square image, max 2MB"})]})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)(u.A,{initialConfig:L.results_card_config,onConfigChange:e=>{B(s=>({...s,results_card_config:e}))}})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Type *"}),(0,a.jsxs)("select",{name:"business_type",value:L.business_type,onChange:O,required:!0,className:"".concat((0,c._c)()," bg-white"),children:[(0,a.jsx)("option",{value:"",children:"Select Business Type"}),(0,a.jsx)("option",{value:"restaurant",children:"Restaurant"}),(0,a.jsx)("option",{value:"cafe",children:"Caf\xe9"}),(0,a.jsx)("option",{value:"hotel",children:"Hotel"}),(0,a.jsx)("option",{value:"catering",children:"Catering"}),(0,a.jsx)("option",{value:"other",children:"Other"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Email *"}),(0,a.jsx)("input",{type:"email",name:"business_email",value:L.business_email,onChange:O,required:!0,className:"".concat((0,c._c)()," bg-white")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone Number"}),(0,a.jsx)("input",{type:"tel",name:"phone",value:L.phone,onChange:O,className:"".concat((0,c._c)()," bg-white")})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"License Number"}),(0,a.jsx)("input",{type:"text",name:"license_number",value:L.license_number,onChange:O,placeholder:"e.g., LA123456",className:"".concat((0,c._c)()," bg-white")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{type:"text",name:"address.street",value:L.address.street,onChange:O,placeholder:"Street Address",className:"".concat((0,c._c)()," bg-white")}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsx)("input",{type:"text",name:"address.city",value:L.address.city,onChange:O,placeholder:"City",className:"".concat((0,c._c)()," bg-white")}),(0,a.jsx)("input",{type:"text",name:"address.region",value:L.address.region,onChange:O,placeholder:"Region/State",className:"".concat((0,c._c)()," bg-white")}),(0,a.jsx)("input",{type:"text",name:"address.postalCode",value:L.address.postalCode,onChange:O,placeholder:"Postal Code",className:"".concat((0,c._c)()," bg-white")})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Monthly Deliveries"}),(0,a.jsxs)("select",{name:"estimated_monthly_deliveries",value:L.estimated_monthly_deliveries,onChange:O,className:"".concat((0,c._c)()," bg-white"),children:[(0,a.jsx)("option",{value:25,children:"1-25 deliveries"}),(0,a.jsx)("option",{value:75,children:"26-75 deliveries"}),(0,a.jsx)("option",{value:150,children:"76-150 deliveries"}),(0,a.jsx)("option",{value:300,children:"151-300 deliveries"}),(0,a.jsx)("option",{value:500,children:"300+ deliveries"})]})]}),t&&(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-xl border",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Subscription Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,a.jsx)("span",{className:"ml-2 px-2 py-1 rounded-full text-xs font-medium ".concat("active"===t.subscription_status?"bg-green-100 text-green-800":"trial"===t.subscription_status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"),children:t.subscription_status||"Unknown"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Tier:"}),(0,a.jsx)("span",{className:"ml-2 font-medium text-gray-900 capitalize",children:t.subscription_tier||"Standard"})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",disabled:b,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02] disabled:transform-none",children:b?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2"}),"Saving..."]}):"Save Changes"})})]}),j&&(0,a.jsx)(d.A,{selectedBackground:S,onBackgroundChange:e=>{k(e.file_url),f(!1)},onClose:()=>f(!1),theme:"light"}),_&&t&&(0,a.jsx)(m.A,{isOpen:_,uploadType:w,onUploadSuccess:()=>{N(!1),M()},onClose:()=>N(!1),theme:"dark"}),A&&(0,a.jsxs)("div",{className:"text-center mt-8 pt-6 border-t border-white/10",children:[(0,a.jsx)("button",{onClick:()=>I.push("/console/dashboard?setup=completed"),className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-medium py-3 px-8 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:"\uD83D\uDE80 Continue to Dashboard"}),(0,a.jsx)("p",{className:"".concat((0,c.$$)("meta")," text-white/60 mt-2"),children:"You can always return to settings later"})]}),(0,a.jsx)("div",{className:"text-center mt-8 pt-4 border-t border-white/10",children:(0,a.jsx)("p",{className:"".concat((0,c.$$)("version")," text-gray-500"),children:(0,o.VM)("dev")})})]})})]})}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"redirect")&&t.d(s,{redirect:function(){return a.redirect}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}})}},e=>{e.O(0,[9535,8337,5552,2124,427,3019,8441,5964,7358],()=>e(e.s=1957)),_N_E=e.O()}]);