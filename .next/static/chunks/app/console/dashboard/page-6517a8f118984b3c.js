(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2231],{6116:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>c});var o=s(5155),t=s(2115),r=s(1026);s(6677);var n=s(1811),l=s(8337),d=s(5552);function c(){var e;let[a,s]=(0,t.useState)(!0),[c,i]=(0,t.useState)(null),[m,h]=(0,t.useState)(null),[u,x]=(0,t.useState)(null),[p,b]=(0,t.useState)(null);return((0,t.useEffect)(()=>((async()=>{let{data:{user:e}}=await n.supabase.auth.getUser();if(e){i(e);try{let a=await (0,d.LE)(e.id);a?(h(a),console.log("✅ Real user authenticated with company:",a.name)):console.log("ℹ️ User has no associated company - company setup needed")}catch(e){console.error("Error loading client info:",e),console.log("ℹ️ Company association not found - this is expected for new users or in demo mode")}}else(window.location.pathname.startsWith("/console")||"true"===new URLSearchParams(window.location.search).get("demo")||document.cookie.includes("demo-session=active")||window.location.pathname.includes("demo"))&&(console.log("\uD83D\uDE80 Dashboard demo mode detected"),console.log("URL params:",window.location.search),console.log("Cookies:",document.cookie),i({id:"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a01",email:"demo@example.com",app_metadata:{},user_metadata:{full_name:"Demo User - Production"},aud:"authenticated",role:"authenticated",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),console.log("✅ Demo user set for dashboard"));s(!1)})(),()=>{}),[]),(0,t.useEffect)(()=>{let e=async()=>{try{let{data:e,error:a}=await n.supabase.from("delivery_records").select("*").order("created_at",{ascending:!1}).limit(1);if(console.log("\uD83D\uDCCA Dashboard: Fetched delivery records:",e),console.log("\uD83D\uDCCA Dashboard: Query error:",a),a)return void console.error("Error fetching delivery records:",a);if(e&&e.length>0){let a=e[0];if(console.log("\uD83D\uDCCA Dashboard: Latest record:",a),console.log("\uD83D\uDCCA Dashboard: Record analysis:",a.analysis),console.log("\uD83D\uDCCA Dashboard: Record extraction_data:",a.extraction_data),x(a),a.analysis||a.extraction_data){let e=a.analysis||a.extraction_data;console.log("\uD83D\uDCCA Dashboard: Setting processing results:",e),b(e)}else console.log("\uD83D\uDCCA Dashboard: No analysis or extraction_data found in record")}else console.log("\uD83D\uDCCA Dashboard: No delivery records found")}catch(e){console.error("Error in fetchLatestResults:",e)}};c&&e()},[c]),a)?(0,o.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,o.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,o.jsx)("div",{className:(0,l.ed)("primary"),children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-4"}),(0,o.jsx)("p",{className:"".concat((0,l.$$)("body")," font-medium"),children:"Loading Dashboard..."})]})})})}):(0,o.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,o.jsxs)("div",{className:"mb-8",children:[(0,o.jsx)("h1",{className:"".concat((0,l.$$)("pageTitle")," text-white drop-shadow-lg"),children:"Intelligence Dashboard"}),(0,o.jsx)("p",{className:"".concat((0,l.$$)("bodySmall")," text-white/90 drop-shadow-md"),children:"AI-powered insights, compliance analytics, and predictive recommendations"}),m&&(0,o.jsxs)("p",{className:"text-blue-300 text-sm mt-2",children:[m.name," • ",m.role]}),c&&!m&&(0,o.jsxs)("p",{className:"text-blue-300 text-sm mt-2",children:[(null==(e=c.user_metadata)?void 0:e.full_name)||c.email," • Demo Mode"]})]}),(0,o.jsx)("div",{className:"space-y-6",children:(0,o.jsxs)("div",{className:"space-y-6",children:[null,(null==m?void 0:m.id)&&(0,o.jsx)("div",{children:(()=>{try{return(0,o.jsx)(r.A,{clientId:m.id,userId:c.id})}catch(e){return console.error("EnhancedComplianceDashboard error:",e),(0,o.jsx)("div",{className:(0,l.ed)("primary"),children:(0,o.jsxs)("div",{className:"text-center py-12",children:[(0,o.jsx)("h2",{className:"".concat((0,l.$$)("sectionTitle")," text-white mb-4"),children:"\uD83D\uDCCA Compliance Dashboard"}),(0,o.jsx)("p",{className:"".concat((0,l.$$)("body")," text-white/80 mb-6"),children:"Dashboard is loading... If this persists, please contact support."}),(0,o.jsx)("div",{className:"bg-orange-600/20 border border-orange-400/30 rounded-xl p-4",children:(0,o.jsx)("p",{className:"text-orange-200 text-sm",children:"Loading enhanced dashboard features..."})})]})})}})()})]})})]})}},8706:(e,a,s)=>{Promise.resolve().then(s.bind(s,6116))}},e=>{e.O(0,[9535,8337,5552,427,5632,8441,5964,7358],()=>e(e.s=8706)),_N_E=e.O()}]);