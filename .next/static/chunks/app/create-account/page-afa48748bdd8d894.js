(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{1811:(e,t,a)=>{"use strict";a.d(t,{BP:()=>g,HK:()=>p,FX:()=>f,tB:()=>h,supabase:()=>y});var r=a(5647),s=a(9535),n=a(9509);let o="https://rggdywqnvpuwssluzfud.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZ2R5d3FudnB1d3NzbHV6ZnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzOTIwMTAsImV4cCI6MjA2OTk2ODAxMH0.j1AiBUEfjqVxLu8ARtH5B_DBKI1dg2EKgp_VZtprAzg";if(!o||!l)throw Error("Missing Supabase environment variables. Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.");let i=(0,s.createBrowserClient)(o,l),c=n.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY||n.env.SUPABASE_SERVICE_ROLE_KEY;c&&(0,r.UU)(o,c,{auth:{autoRefreshToken:!1,persistSession:!1}});let d="delivery-dockets",u=new Map,m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3600;if(arguments.length>2&&arguments[2],!e||""===e.trim()||"null"===e||"undefined"===e)return"";try{let a=e.split("/").pop()||e;console.log("\uD83D\uDD0D Generating signed URL for:",a),console.log("\uD83D\uDD0D Using bucket:",d),console.log("\uD83D\uDD0D Original path:",e);let{data:r,error:s}=await i.storage.from(d).list("",{limit:100});console.log("\uD83D\uDD0D Files in bucket:",(null==r?void 0:r.map(e=>e.name))||[]),console.log("\uD83D\uDD0D Looking for file:",a);let n=i.storage.from(d).createSignedUrl(a,t),{data:o,error:l}=await new Promise((e,t)=>{let a=setTimeout(()=>{t(Error("Timeout after ".concat(1e4,"ms")))},1e4);n.then(e).catch(t).finally(()=>clearTimeout(a))});if(l)return console.error("❌ Signed URL generation failed:",l),"";if(null==o?void 0:o.signedUrl)return console.log("✅ Signed URL generated:",o.signedUrl),o.signedUrl;return console.log("❌ No signed URL returned from Supabase"),""}catch(e){return console.error("❌ Signed URL exception:",e),""}},p=async(e,t)=>await m(e,3600,t),h=async(e,t)=>{let{data:a,error:r}=await i.from("client_users").select("role").eq("user_id",e).eq("client_id",t).eq("status","active").single();return r?(console.error("Error fetching user role:",r),null):(null==a?void 0:a.role)||null},f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,a="delivery-records-".concat(e,"-").concat(t);if(u.has(a))return u.get(a);let r=(async()=>{try{let a=new AbortController,r=setTimeout(()=>a.abort(),3e4),s=await fetch("/api/delivery-records?clientId=".concat(e,"&limit=").concat(t),{signal:a.signal});if(clearTimeout(r),!s.ok)throw Error("HTTP ".concat(s.status,": Failed to fetch delivery records"));let n=await s.json();if(!n.success)throw Error(n.error||"Failed to fetch delivery records");return n.data||[]}catch(t){return t instanceof Error&&"AbortError"===t.name?console.error("⏰ Delivery records request timed out for clientId:",e):console.error("❌ Error fetching delivery records for clientId:",e,t),[]}finally{u.delete(a)}})();return u.set(a,r),r},g=async e=>{let t="compliance-alerts-".concat(e);if(u.has(t))return u.get(t);let a=(async()=>{try{let t=new AbortController,a=setTimeout(()=>t.abort(),3e4),r=await fetch("/api/compliance-alerts?clientId=".concat(e),{signal:t.signal});if(clearTimeout(a),!r.ok)return console.warn("⚠️ Compliance alerts API not configured for demo mode"),[];let s=await r.json();if(!s.success)return[];return s.data||[]}catch(e){return e instanceof Error&&"AbortError"===e.name?console.warn("⏰ Compliance alerts request timed out"):console.warn("⚠️ Compliance alerts not available in demo mode"),[]}finally{u.delete(t)}})();return u.set(t,a),a};var b=a(9509);let x=null;try{let e="https://rggdywqnvpuwssluzfud.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZ2R5d3FudnB1d3NzbHV6ZnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzOTIwMTAsImV4cCI6MjA2OTk2ODAxMH0.j1AiBUEfjqVxLu8ARtH5B_DBKI1dg2EKgp_VZtprAzg",a=b.env.SUPABASE_SERVICE_ROLE_KEY;e&&t&&(x=(0,r.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,storageKey:"hospitality-compliance-auth"}})),e&&a&&(0,r.UU)(e,a,{auth:{autoRefreshToken:!1,persistSession:!1}})}catch(e){console.warn("Supabase client initialization failed:",e instanceof Error?e.message:"Unknown error")}let y=x;console.log("\uD83D\uDE80 Database Core lib loaded - Modular Architecture v1.8.19")},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"redirect")&&a.d(t,{redirect:function(){return r.redirect}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},8372:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>u});var r=a(5155),s=a(9175),n=a(8337),o=a(2115),l=a(5695),i=a(1811),c=a(6874),d=a.n(c);function u(){let[e,t]=(0,o.useState)(!1),[a,c]=(0,o.useState)({businessName:"",email:"",fullName:"",phone:"",businessType:"restaurant",password:"",confirmPassword:""}),[u,m]=(0,o.useState)(""),p=(0,l.useRouter)(),h=e=>{let{name:t,value:a}=e.target;c(e=>({...e,[t]:a}))},f=async e=>{if(e.preventDefault(),m(""),t(!0),a.password!==a.confirmPassword){m("Passwords do not match"),t(!1);return}if(a.password.length<8){m("Password must be at least 8 characters long"),t(!1);return}try{let{data:e,error:r}=await i.supabase.auth.signUp({email:a.email,password:a.password,options:{data:{full_name:a.fullName,business_name:a.businessName,phone:a.phone,business_type:a.businessType}}});if(r){m(r.message),t(!1);return}if(e.user)try{let r=await fetch("/api/create-company",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({businessName:a.businessName,businessType:a.businessType,phone:a.phone,userId:e.user.id,email:a.email,fullName:a.fullName})}),s=await r.json();if(!r.ok){console.error("Company creation failed:",s),m("Account created but company setup failed: ".concat(s.error)),t(!1);return}console.log("✅ Account and company created successfully"),p.push("/admin/company-settings?onboarding=true&company=created")}catch(e){console.error("Company creation error:",e),m("Account created but company setup failed. Please contact support."),t(!1)}}catch(e){m("An unexpected error occurred. Please try again."),t(!1)}};return(0,r.jsxs)("div",{className:"min-h-screen relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('https://images.unsplash.com/photo-1544148103-0773bf10d330?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3')",filter:"brightness(0.6)"}}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black/30"}),(0,r.jsx)("header",{className:"absolute top-0 left-0 right-0 z-20",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex items-center justify-center h-24",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("div",{className:"w-12 h-12",children:(0,r.jsx)("img",{src:"/JiGR_Logo-full_figma_circle.png",alt:"JiGR Logo",className:"w-12 h-12 object-contain"})}),(0,r.jsx)("span",{className:"text-white font-bold text-2xl",children:"Hospitality Compliance"})]})})})}),(0,r.jsx)("div",{className:"relative z-10 min-h-screen flex items-center justify-center px-4 pt-40",children:(0,r.jsxs)("div",{className:"".concat((0,n.ed)("primary")," max-w-md w-full mx-auto"),children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"".concat((0,n.$$)("pageTitle")," mb-2 tracking-tight"),children:"Create Account"}),(0,r.jsx)("p",{className:"".concat((0,n.$$)("bodySmall")," font-light"),children:"Start your compliance journey today"})]}),(0,r.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",name:"businessName",placeholder:"Business Name",value:a.businessName,onChange:h,required:!0,className:(0,n._c)()})}),(0,r.jsx)("div",{children:(0,r.jsxs)("select",{name:"businessType",value:a.businessType,onChange:h,required:!0,className:(0,n._c)(),children:[(0,r.jsx)("option",{value:"restaurant",className:"text-gray-800",children:"Restaurant"}),(0,r.jsx)("option",{value:"cafe",className:"text-gray-800",children:"Caf\xe9"}),(0,r.jsx)("option",{value:"hotel",className:"text-gray-800",children:"Hotel"}),(0,r.jsx)("option",{value:"catering",className:"text-gray-800",children:"Catering"}),(0,r.jsx)("option",{value:"other",className:"text-gray-800",children:"Other"})]})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"text",name:"fullName",placeholder:"Your Full Name",value:a.fullName,onChange:h,required:!0,className:(0,n._c)()})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"email",name:"email",placeholder:"Business Email",value:a.email,onChange:h,required:!0,className:(0,n._c)()})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:a.phone,onChange:h,className:(0,n._c)()})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"password",name:"password",placeholder:"Password (8+ characters)",value:a.password,onChange:h,required:!0,className:(0,n._c)()})}),(0,r.jsx)("div",{children:(0,r.jsx)("input",{type:"password",name:"confirmPassword",placeholder:"Confirm Password",value:a.confirmPassword,onChange:h,required:!0,className:(0,n._c)()})}),u&&(0,r.jsx)("div",{className:"bg-red-500/20 border border-red-400/30 rounded-xl p-3",children:(0,r.jsx)("p",{className:"text-red-200 text-sm text-center",children:u})}),(0,r.jsx)("button",{type:"submit",disabled:e,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02] disabled:transform-none",children:e?(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2"}),"Creating Account..."]}):"Create Account"})]}),(0,r.jsx)("div",{className:"text-center mt-6",children:(0,r.jsxs)("p",{className:"".concat((0,n.$$)("body")," ").concat(n.Bg.colors.text.onGlassSecondary),children:["Already have an account?"," ",(0,r.jsx)(d(),{href:"/signin",className:"text-blue-300 hover:text-blue-200 font-semibold transition-colors duration-200",children:"Sign In"})]})}),(0,r.jsx)("div",{className:"text-center mt-6 pt-4 border-t border-white/10",children:(0,r.jsx)("p",{className:"".concat((0,n.$$)("version")," ").concat(n.Bg.colors.text.onGlassSecondary),children:(0,s.VM)("prod")})})]})})]})}},8988:(e,t,a)=>{Promise.resolve().then(a.bind(a,8372))},9175:(e,t,a)=>{"use strict";a.d(t,{VM:()=>i});let r={major:1,month:9,day:5,build:13,alpha:""},s="".concat(r.major,".").concat(r.month,".").concat(r.day,".").concat(String(r.build).padStart(3,"0")).concat(r.alpha),n="".concat(r.major,".").concat(r.month,".").concat(r.day).concat(r.alpha),o=new Date().toISOString().split("T")[0],l="production";parseInt(s.split(".")[0]),parseInt(s.split(".")[1]),s.split(".")[2];let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"short",t="v".concat(s);switch(e){case"short":default:return t;case"full":return"".concat(t," (").concat(o,")");case"detailed":return"".concat(t," (").concat(l,") - Built: ").concat(o);case"dev":return"".concat(t," | ").concat(l.toUpperCase());case"prod":return"v".concat(n)}}}},e=>{e.O(0,[9535,6874,8337,8441,5964,7358],()=>e(e.s=8988)),_N_E=e.O()}]);