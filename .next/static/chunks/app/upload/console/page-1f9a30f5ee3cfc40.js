(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5268],{357:(e,t,a)=>{Promise.resolve().then(a.bind(a,5785))},3827:(e,t,a)=>{"use strict";a.d(t,{Bo:()=>r,MJ:()=>n,NO:()=>c});let s="https://rggdywqnvpuwssluzfud.supabase.co",l={UI_ICONS:"ui-icons",MODULE_ASSETS:"module-assets"};function i(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!s)return console.warn("SUPABASE_URL not configured, falling back to local images"),"/fallback-".concat(t);let{width:l,height:i,quality:r=85,format:n="webp"}=a,o="".concat(s,"/storage/v1/object/public/").concat(e,"/").concat(t),c=[];return l&&c.push("width=".concat(l)),i&&c.push("height=".concat(i)),85!==r&&c.push("quality=".concat(r)),"auto"!==n&&c.push("format=".concat(n)),c.length>0&&(o+="?".concat(c.join("&"))),o}function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=e.replace(/\.(png|jpg|jpeg|webp|svg)$/i,"");return i(l.MODULE_ASSETS,"".concat(a,".png"),{format:"webp",quality:85,...t})}function n(){return i(l.MODULE_ASSETS,"backgrounds/chef-workspace.jpg",{format:"webp",quality:75,width:1920,height:1080})}let o={JiGRupload:"navigation/JiGRupload",JiGRcamera:"navigation/JiGRcamera",JiGRmodules:"navigation/JiGRmodules",JiGRadmin:"navigation/JiGRadmin",JiGRsignout:"navigation/JiGRsignout",JiGRbulk:"actions/JiGRbulk",JiGRqueue:"actions/JiGRqueue",JiGRsummary:"actions/JiGRsummary",JiGRwarning:"actions/JiGRwarning",JiGRStats:"actions/JiGRStats",JiGRdiaryWhite:"modules/JiGRdiaryWhite",JiGRstockWhite:"modules/JiGRstockWhite",JiGRuploadWhite:"modules/JiGRuploadWhite",JiGRtemp:"modules/JiGRtemp",JiGRrepairs:"modules/JiGRrepairs",JiGRmenus:"modules/JiGRmenus",JiGRrecipes:"modules/JiGRrecipes",JiGRstocktake:"modules/JiGRstocktake",JiGRadmin2:"modules/JiGRadmin2",JiGRcompliance:"modules/JiGRcompliance",JiGRmenu:"modules/JiGRmenu"};function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,a=o[e];return a?i(l.UI_ICONS,"".concat(a,".png"),{width:t,height:t,format:"webp",quality:90}):(console.warn("Icon mapping not found for: ".concat(e)),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24,a=e.replace(/\.(png|jpg|jpeg|webp|svg)$/i,"");return i(l.UI_ICONS,"".concat(a,".png"),{width:t,height:t,format:"webp",quality:90})}(e,t))}},5785:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(5155),l=a(2115),i=a(1026),r=a(6677),n=a(1811),o=a(8337),c=a(5552),d=a(3827),u=a(6766);function m(){var e;let[t,a]=(0,l.useState)(!0),[m,h]=(0,l.useState)(null),[p,x]=(0,l.useState)(null),[g,f]=(0,l.useState)(null),[v,b]=(0,l.useState)(null),[w,j]=(0,l.useState)([]),[_,N]=(0,l.useState)(0),[y,R]=(0,l.useState)(0),[J,G]=(0,l.useState)(0);(0,l.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await n.supabase.auth.getUser();if(e){h(e);try{let t=await (0,c.LE)(e.id);t&&(x(t),console.log("✅ Upload Console: Real user authenticated with company:",t.name))}catch(e){console.error("Error loading client info:",e)}}else{let e={id:"a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a01",email:"demo@example.com",app_metadata:{},user_metadata:{full_name:"Demo User - Upload Console"},aud:"authenticated",role:"authenticated",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h(e)}}catch(e){console.error("Authentication error:",e)}a(!1)})()},[]),(0,l.useEffect)(()=>{(async()=>{if(m)try{let e=new Date().toISOString().split("T")[0],{data:t,error:a}=await n.supabase.from("delivery_records").select("*").gte("created_at","".concat(e,"T00:00:00")).lt("created_at","".concat(e,"T23:59:59")).order("created_at",{ascending:!1}).limit(10);t&&!a&&(j(t),console.log("\uD83D\uDCCA Console: Loaded ".concat(t.length," uploads from today")))}catch(e){console.error("❌ Failed to load today's uploads:",e)}})()},[m]),(0,l.useEffect)(()=>{let e=async()=>{try{let{data:t,error:a}=await n.supabase.from("delivery_records").select("*").order("created_at",{ascending:!1}).limit(1);if(console.log("\uD83D\uDCCA Upload Console: Fetched delivery records:",t),console.log("\uD83D\uDCCA Total delivery records found:",(null==t?void 0:t.length)||0),a)return void console.error("Error fetching delivery records:",a);if(t&&t.length>0){var e;let a=t[0];if(console.log("\uD83D\uDCCA Upload Console: Latest record FULL DATA:",a),console.log("\uD83D\uDCCA Supplier fields check:",{supplier_name:a.supplier_name,supplier_info:a.supplier_info,supplier:a.supplier,company_name:a.company_name,analysis:a.analysis,extraction_data:a.extraction_data}),console.log("\uD83D\uDCCA Image path FOR THUMBNAIL:",a.image_path),console.log("\uD83D\uDCCA Raw extracted text length:",(null==(e=a.raw_extracted_text)?void 0:e.length)||0),f(a),a.analysis||a.extraction_data){let e=a.analysis||a.extraction_data;console.log("\uD83D\uDCCA Upload Console: Setting processing results:",e),b(e)}}}catch(e){console.error("Error in fetchLatestResults:",e)}};console.log("\uD83D\uDD0D Console useEffect: user state:",m?"User exists":"No user"),m?(console.log("\uD83D\uDD0D Console: Calling fetchLatestResults()"),e()):console.log("\uD83D\uDD0D Console: Skipping fetchLatestResults - no user")},[m]);let S=async()=>{try{let{count:e}=await n.supabase.from("delivery_records").select("*",{count:"exact",head:!0});N(e||0);let{count:t}=await n.supabase.from("delivery_records").select("*",{count:"exact",head:!0}).neq("processing_status","completed");R(t||0);let{count:a}=await n.supabase.from("delivery_records").select("*",{count:"exact",head:!0}).eq("processing_status","completed"),{count:s}=await n.supabase.from("delivery_records").select("*",{count:"exact",head:!0}).eq("processing_status","failed"),l=(a||0)+(s||0),i=l>0?Math.round((a||0)/l*100):0;G(i),console.log("\uD83D\uDCCA Statistics updated:",{total:e,processing:t,completed:a,failed:s,successRate:i})}catch(e){console.error("❌ Failed to fetch statistics:",e)}},k=async()=>{console.log("\uD83D\uDD04 Manual refresh triggered"),await S();let{data:e,error:t}=await n.supabase.from("delivery_records").select("*").order("created_at",{ascending:!1}).limit(10);if(console.log("\uD83D\uDD04 Manual refresh - Found records:",(null==e?void 0:e.length)||0),t)return void console.error("\uD83D\uDD04 Manual refresh error:",t);if(e&&e.length>0){let t=e[0];f(t),(t.analysis||t.extraction_data)&&b(t.analysis||t.extraction_data)}};return((0,l.useEffect)(()=>{if(m){let e=setTimeout(()=>{k()},2e3);return()=>clearTimeout(e)}},[m]),(0,l.useEffect)(()=>{if(m){let e=setInterval(()=>{S()},3e4);return()=>clearInterval(e)}},[m]),t)?(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,s.jsx)("div",{className:(0,o.ed)("primary"),children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin h-8 w-8 border-2 border-white border-t-transparent rounded-full mx-auto mb-4"}),(0,s.jsx)("p",{className:"".concat((0,o.$$)("body")," font-medium"),children:"Loading Upload Console..."})]})})})}):(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-8",children:[(0,s.jsx)("div",{className:"mb-16",children:(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-6 items-center",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 col-span-2",children:[(0,s.jsx)(u.default,{src:(0,d.Bo)("icons/JiGRupload",{width:96,height:96}),alt:"Upload Module",width:96,height:96,className:"object-contain"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"".concat((0,o.$$)("pageTitle")," text-white drop-shadow-lg text-4xl font-bold"),children:"UPLOAD"}),(0,s.jsx)("p",{className:"text-white/80 drop-shadow-md italic text-xs",children:"Document upload, processing, and compliance management"}),p&&(0,s.jsxs)("p",{className:"text-blue-300 text-sm mt-1",children:[p.name," • ",p.role]})]})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsxs)("div",{className:"flex space-x-1 bg-black/20 p-0.5 rounded-full backdrop-blur-md border border-white/20",children:[(0,s.jsx)("a",{href:"/upload/console",className:"px-4 py-2 font-semibold text-black bg-white rounded-full transition-all duration-300 text-sm TouchTarget",children:"Console"}),(0,s.jsx)("a",{href:"/upload/capture",className:"px-4 py-2 font-medium text-white/90 hover:text-white hover:bg-white/20 rounded-full transition-all duration-300 text-sm TouchTarget",children:"Capture"}),(0,s.jsx)("a",{href:"/upload/reports",className:"px-4 py-2 font-medium text-white/90 hover:text-white hover:bg-white/20 rounded-full transition-all duration-300 text-sm TouchTarget",children:"Reports"})]})}),(0,s.jsx)("div",{})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 AdaptiveLayout",children:[(0,s.jsxs)("div",{className:"bg-white/15 backdrop-blur-lg border border-white/20 rounded-3xl p-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 w-20 h-20 bg-blue-500/10 rounded-full -mr-10 -mt-10"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-blue-300 text-sm font-medium",children:"Total Uploads"})}),(0,s.jsx)("div",{className:"text-3xl font-bold text-white mb-1",children:_}),(0,s.jsx)("div",{className:"text-green-300 text-sm",children:(0,s.jsx)("span",{className:"inline-flex items-center space-x-1",children:(0,s.jsx)("span",{children:_>0?"Documents uploaded":"Ready to process"})})})]})]}),(0,s.jsxs)("div",{className:"bg-white/15 backdrop-blur-lg border border-white/20 rounded-3xl p-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 w-20 h-20 bg-purple-500/10 rounded-full -mr-10 -mt-10"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-purple-300 text-sm font-medium",children:"Processing"})}),(0,s.jsx)("div",{className:"text-3xl font-bold text-white mb-1",children:y}),(0,s.jsx)("div",{className:"text-blue-300 text-sm",children:(0,s.jsx)("span",{className:"inline-flex items-center space-x-1",children:(0,s.jsx)("span",{children:y>0?"Currently processing":"AI ready"})})})]})]}),(0,s.jsxs)("div",{className:"bg-white/15 backdrop-blur-lg border border-white/20 rounded-3xl p-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 w-20 h-20 bg-green-500/10 rounded-full -mr-10 -mt-10"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-green-300 text-sm font-medium",children:"Success Rate"})}),(0,s.jsx)("div",{className:"text-3xl font-bold text-white mb-1",children:_>0?"".concat(J,"%"):"--"}),(0,s.jsx)("div",{className:"text-green-300 text-sm",children:(0,s.jsx)("span",{className:"inline-flex items-center space-x-1",children:(0,s.jsx)("span",{children:_>0?"Processing success rate":"No data yet"})})})]})]})]}),(0,s.jsxs)("div",{className:"space-y-16",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(0,s.jsx)("div",{className:"md:col-span-2 lg:col-span-3",children:(0,s.jsxs)("div",{className:"bg-white/15 backdrop-blur-lg border border-white/20 rounded-3xl p-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 w-20 h-20 bg-green-500/10 rounded-full -mr-10 -mt-10"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("span",{className:"text-green-300 text-sm font-medium",children:"UPLOADS TODAY"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("span",{className:"text-green-200 text-xs",children:[w.length," documents"]}),(0,s.jsx)("button",{onClick:k,className:"text-white/70 hover:text-white transition-colors duration-200 p-1 hover:bg-white/10 rounded-md TouchTarget",title:"Refresh data",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})]}),w.length>0?(0,s.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:w.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-4 bg-white/5 rounded-lg p-3",children:[e.image_path&&(0,s.jsx)("div",{className:"w-12 h-12 bg-white/10 rounded-lg overflow-hidden flex-shrink-0",children:(0,s.jsx)("img",{src:e.image_path,alt:"Upload thumbnail",className:"w-full h-full object-cover",onError:e=>{var t;let a=e.currentTarget;a.style.display="none";let s=document.createElement("div");s.className="w-12 h-12 bg-white/10 rounded-lg flex items-center justify-center",s.innerHTML='<div class="text-white/60 text-lg">\uD83D\uDCC4</div>',null==(t=a.parentNode)||t.appendChild(s)}})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"text-white font-medium text-sm truncate",children:e.supplier_name||"Processing..."}),(0,s.jsxs)("div",{className:"text-green-200/80 text-xs",children:[new Date(e.created_at).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),e.item_count&&e.item_count>0&&(0,s.jsxs)("span",{className:"ml-2",children:["• ",e.item_count," items"]})]})]})]},e.id||t))}):(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-white/60 text-2xl mb-2",children:"\uD83D\uDCC4"}),(0,s.jsx)("h3",{className:"text-white text-sm font-medium",children:"No uploads today"}),(0,s.jsx)("p",{className:"text-white/60 text-xs",children:"Visit capture page to upload documents"})]})})]})]})})})}),(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 AdaptiveLayout",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,s.jsx)("h2",{className:"".concat((0,o.$$)("sectionTitle")," text-white"),children:"Latest Upload"})}),g?(0,s.jsx)(r.A,{data:{id:g.id,supplier_name:(()=>{try{if(g.raw_extracted_text){let e=JSON.parse(g.raw_extracted_text);if(e.supplier_name)return e.supplier_name}}catch(e){console.log("Could not parse raw_extracted_text as JSON")}return g.supplier_name||g.supplier_info||g.supplier||g.company_name||"Unknown Supplier"})(),delivery_date:(()=>{try{if(g.raw_extracted_text){let e=JSON.parse(g.raw_extracted_text);if(e.delivery_date)return e.delivery_date}}catch(e){console.log("Could not parse raw_extracted_text for delivery_date")}return g.delivery_date||g.created_at})(),created_at:g.created_at,uploaded_by:g.uploaded_by,image_path:g.image_path,user_name:(null==m||null==(e=m.user_metadata)?void 0:e.full_name)||(null==m?void 0:m.email),confidence_score:g.confidence_score,client_id:g.client_id||(null==p?void 0:p.id),raw_extracted_text:g.raw_extracted_text,line_items:g.line_items,temperature_reading:g.temperature_reading,analysis:g.analysis,extraction_data:g.extraction_data},userId:null==m?void 0:m.id}):(0,s.jsxs)("div",{className:"bg-white/15 backdrop-blur-lg border border-white/20 rounded-3xl p-6 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 w-20 h-20 bg-blue-500/10 rounded-full -mr-10 -mt-10"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,s.jsx)("span",{className:"text-blue-300 text-sm font-medium",children:"No Uploads Today"})})})]})]})}),(null==p?void 0:p.id)&&(0,s.jsx)("div",{children:(()=>{try{return(0,s.jsx)(i.A,{clientId:p.id,userId:m.id})}catch(e){return console.error("EnhancedComplianceDashboard error:",e),(0,s.jsx)("div",{className:(0,o.ed)("primary"),children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("h2",{className:"".concat((0,o.$$)("sectionTitle")," text-white mb-4"),children:"\uD83D\uDCCA Compliance Analytics"}),(0,s.jsx)("p",{className:"".concat((0,o.$$)("body")," text-white/80 mb-6"),children:"Dashboard is loading... If this persists, please contact support."}),(0,s.jsx)("div",{className:"bg-orange-600/20 border border-orange-400/30 rounded-xl p-4",children:(0,s.jsx)("p",{className:"text-orange-200 text-sm",children:"Loading enhanced compliance features..."})})]})})}})()})]})]})}}},e=>{e.O(0,[9535,6766,8337,5552,427,5632,8441,5964,7358],()=>e(e.s=357)),_N_E=e.O()}]);