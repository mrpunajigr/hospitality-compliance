(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9531],{1811:(e,t,s)=>{"use strict";s.d(t,{BP:()=>p,HK:()=>m,FX:()=>g,tB:()=>u,supabase:()=>j});var r=s(5647),a=s(9535),i=s(9509);let l="https://rggdywqnvpuwssluzfud.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZ2R5d3FudnB1d3NzbHV6ZnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzOTIwMTAsImV4cCI6MjA2OTk2ODAxMH0.j1AiBUEfjqVxLu8ARtH5B_DBKI1dg2EKgp_VZtprAzg";if(!l||!n)throw Error("Missing Supabase environment variables. Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.");let c=(0,a.createBrowserClient)(l,n),o=i.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY||i.env.SUPABASE_SERVICE_ROLE_KEY;o&&(0,r.UU)(l,o,{auth:{autoRefreshToken:!1,persistSession:!1}});let d="delivery-dockets",x=new Map,h=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3600;if(arguments.length>2&&arguments[2],!e||""===e.trim()||"null"===e||"undefined"===e)return"";try{let s=e.split("/").pop()||e;console.log("\uD83D\uDD0D Generating signed URL for:",s),console.log("\uD83D\uDD0D Using bucket:",d),console.log("\uD83D\uDD0D Original path:",e);let{data:r,error:a}=await c.storage.from(d).list("",{limit:100});console.log("\uD83D\uDD0D Files in bucket:",(null==r?void 0:r.map(e=>e.name))||[]),console.log("\uD83D\uDD0D Looking for file:",s);let i=c.storage.from(d).createSignedUrl(s,t),{data:l,error:n}=await new Promise((e,t)=>{let s=setTimeout(()=>{t(Error("Timeout after ".concat(1e4,"ms")))},1e4);i.then(e).catch(t).finally(()=>clearTimeout(s))});if(n)return console.error("❌ Signed URL generation failed:",n),"";if(null==l?void 0:l.signedUrl)return console.log("✅ Signed URL generated:",l.signedUrl),l.signedUrl;return console.log("❌ No signed URL returned from Supabase"),""}catch(e){return console.error("❌ Signed URL exception:",e),""}},m=async(e,t)=>await h(e,3600,t),u=async(e,t)=>{let{data:s,error:r}=await c.from("client_users").select("role").eq("user_id",e).eq("client_id",t).eq("status","active").single();return r?(console.error("Error fetching user role:",r),null):(null==s?void 0:s.role)||null},g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,s="delivery-records-".concat(e,"-").concat(t);if(x.has(s))return x.get(s);let r=(async()=>{try{let s=new AbortController,r=setTimeout(()=>s.abort(),3e4),a=await fetch("/api/delivery-records?clientId=".concat(e,"&limit=").concat(t),{signal:s.signal});if(clearTimeout(r),!a.ok)throw Error("HTTP ".concat(a.status,": Failed to fetch delivery records"));let i=await a.json();if(!i.success)throw Error(i.error||"Failed to fetch delivery records");return i.data||[]}catch(t){return t instanceof Error&&"AbortError"===t.name?console.error("⏰ Delivery records request timed out for clientId:",e):console.error("❌ Error fetching delivery records for clientId:",e,t),[]}finally{x.delete(s)}})();return x.set(s,r),r},p=async e=>{let t="compliance-alerts-".concat(e);if(x.has(t))return x.get(t);let s=(async()=>{try{let t=new AbortController,s=setTimeout(()=>t.abort(),3e4),r=await fetch("/api/compliance-alerts?clientId=".concat(e),{signal:t.signal});if(clearTimeout(s),!r.ok)return console.warn("⚠️ Compliance alerts API not configured for demo mode"),[];let a=await r.json();if(!a.success)return[];return a.data||[]}catch(e){return e instanceof Error&&"AbortError"===e.name?console.warn("⏰ Compliance alerts request timed out"):console.warn("⚠️ Compliance alerts not available in demo mode"),[]}finally{x.delete(t)}})();return x.set(t,s),s};var v=s(9509);let f=null;try{let e="https://rggdywqnvpuwssluzfud.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZ2R5d3FudnB1d3NzbHV6ZnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzOTIwMTAsImV4cCI6MjA2OTk2ODAxMH0.j1AiBUEfjqVxLu8ARtH5B_DBKI1dg2EKgp_VZtprAzg",s=v.env.SUPABASE_SERVICE_ROLE_KEY;e&&t&&(f=(0,r.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,storageKey:"hospitality-compliance-auth"}})),e&&s&&(0,r.UU)(e,s,{auth:{autoRefreshToken:!1,persistSession:!1}})}catch(e){console.warn("Supabase client initialization failed:",e instanceof Error?e.message:"Unknown error")}let j=f;console.log("\uD83D\uDE80 Database Core lib loaded - Modular Architecture v1.8.19")},4912:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),a=s(2115),i=s(1811),l=s(8337),n=s(9212);function c(){let[e,t]=(0,a.useState)([]),[s,c]=(0,a.useState)([]),[o,d]=(0,a.useState)(!0),[x,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{m()},[]);let m=async()=>{try{let{data:e,error:s}=await i.supabase.from("delivery_records").select("*").order("created_at",{ascending:!1});s?console.error("Error loading delivery records:",s):(t(e||[]),console.log("Delivery records:",e));let{data:r,error:a}=await i.supabase.from("ai_training_corrections").select("*").order("created_at",{ascending:!1});a?console.error("Error loading training corrections:",a):(c(r||[]),console.log("Training corrections:",r))}catch(e){console.error("Debug loading error:",e)}finally{d(!1),h(!1)}},u=async()=>{h(!0),await m()};return o?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-4 flex items-center justify-center",children:(0,r.jsx)("div",{className:(0,l.ed)("primary"),children:(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-4"}),(0,r.jsx)("p",{className:(0,l.$$)("body"),children:"Loading debug data..."})]})})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-4",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto space-y-6",children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("div",{className:(0,l.ed)("primary"),children:(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"".concat((0,l.$$)("pageTitle")," text-white mb-2"),children:"Debug Training Data"}),(0,r.jsx)("p",{className:"".concat((0,l.$$)("body")," text-slate-300"),children:"Check what records are in the database"})]}),(0,r.jsxs)("button",{onClick:u,disabled:x,className:"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white px-4 py-2 rounded-lg transition-colors",children:[(0,r.jsx)("svg",{className:"w-4 h-4 ".concat(x?"animate-spin":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,r.jsx)("span",{children:x?"Refreshing...":"Refresh"})]})]})})}),(0,r.jsx)("div",{className:(0,l.ed)("secondary"),children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("h2",{className:"".concat((0,l.$$)("sectionTitle")," text-white mb-4"),children:["Delivery Records (",e.length,")"]}),0===e.length?(0,r.jsx)("p",{className:"text-slate-400",children:"No delivery records found"}):(0,r.jsx)("div",{className:"space-y-4",children:e.map((e,t)=>(0,r.jsxs)("div",{className:"p-4 bg-slate-800 rounded-lg",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"ID:"}),(0,r.jsx)("div",{className:"text-slate-300 font-mono text-xs",children:e.id})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Status:"}),(0,r.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat("completed"===e.processing_status?"bg-green-800 text-green-200":"failed"===e.processing_status?"bg-red-800 text-red-200":"bg-yellow-800 text-yellow-200"),children:e.processing_status})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Created:"}),(0,r.jsx)("div",{className:"text-slate-300",children:new Date(e.created_at).toLocaleString()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Supplier:"}),(0,r.jsx)("div",{className:"text-slate-300",children:e.supplier_name||"Not detected"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Image Path:"}),(0,r.jsx)("div",{className:"text-slate-300 text-xs",children:e.image_path})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Confidence:"}),(0,r.jsx)("div",{className:"text-slate-300",children:e.confidence_score?"".concat((100*e.confidence_score).toFixed(1),"%"):"N/A"})]})]}),e.error_message&&(0,r.jsxs)("div",{className:"mt-3 p-3 bg-red-900/30 rounded text-red-200 text-sm",children:[(0,r.jsx)("strong",{children:"Error:"})," ",e.error_message]}),e.raw_extracted_text&&(0,r.jsxs)("div",{className:"mt-3 p-3 bg-slate-700/50 rounded",children:[(0,r.jsx)("strong",{className:"text-white text-sm",children:"Raw Text:"}),(0,r.jsx)("div",{className:"text-slate-300 text-xs mt-1 max-h-20 overflow-y-auto",children:e.raw_extracted_text})]})]},e.id))})]})}),(0,r.jsx)("div",{className:(0,l.ed)("secondary"),children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("h2",{className:"".concat((0,l.$$)("sectionTitle")," text-white mb-4"),children:["Training Corrections (",s.length,")"]}),0===s.length?(0,r.jsx)("p",{className:"text-slate-400",children:"No training corrections found"}):(0,r.jsx)("div",{className:"space-y-4",children:s.map((e,t)=>(0,r.jsx)("div",{className:"p-4 bg-slate-800 rounded-lg",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Record ID:"}),(0,r.jsx)("div",{className:"text-slate-300 font-mono text-xs",children:e.delivery_record_id})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Type:"}),(0,r.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs ".concat("correct"===e.correction_type?"bg-green-800 text-green-200":"wrong"===e.correction_type?"bg-red-800 text-red-200":"bg-yellow-800 text-yellow-200"),children:e.correction_type})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{className:"text-white",children:"Created:"}),(0,r.jsx)("div",{className:"text-slate-300",children:new Date(e.created_at).toLocaleString()})]})]})},e.id))})]})}),(0,r.jsx)("div",{className:(0,l.ed)("primary"),children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h2",{className:"".concat((0,l.$$)("sectionTitle")," text-white mb-4"),children:"Summary"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"text-center p-4 bg-slate-800/50 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-white",children:e.length}),(0,r.jsx)("div",{className:"text-sm text-slate-400",children:"Total Records"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-green-900/30 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-400",children:e.filter(e=>"completed"===e.processing_status).length}),(0,r.jsx)("div",{className:"text-sm text-slate-400",children:"Completed"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-red-900/30 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-400",children:e.filter(e=>"failed"===e.processing_status).length}),(0,r.jsx)("div",{className:"text-sm text-slate-400",children:"Failed"})]}),(0,r.jsxs)("div",{className:"text-center p-4 bg-blue-900/30 rounded-lg",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:s.length}),(0,r.jsx)("div",{className:"text-sm text-slate-400",children:"Corrections"})]})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white mb-3",children:"Available for Training"}),(0,r.jsxs)("p",{className:"text-slate-300",children:["Records with status 'completed' that haven't been corrected yet:",(0,r.jsx)("span",{className:"ml-2 text-white font-bold",children:e.filter(e=>"completed"===e.processing_status&&!s.some(t=>t.delivery_record_id===e.id)).length})]})]})]})})]})})}},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"redirect")&&s.d(t,{redirect:function(){return r.redirect}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},5746:(e,t,s)=>{Promise.resolve().then(s.bind(s,4912))},9212:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var r=s(5155),a=s(6874),i=s.n(a),l=s(5695),n=s(8337);function c(){let e=(0,l.usePathname)();return(0,r.jsx)("div",{className:(0,n.ed)("primary"),children:(0,r.jsx)("div",{className:"p-4",children:(0,r.jsx)("div",{className:"flex flex-col sm:flex-row gap-2",children:[{href:"/upload/bulk-training",label:"\uD83D\uDCC1 Bulk Upload",description:"Upload large docket collections"},{href:"/upload/training",label:"✏️ Review & Correct",description:"Review AI extractions"},{href:"/upload/training-analytics",label:"\uD83D\uDCCA Analytics & Export",description:"View progress & export training data"},{href:"/upload/debug-training",label:"\uD83D\uDD27 Debug",description:"Debug database records"}].map(t=>{let s=e===t.href;return(0,r.jsxs)(i(),{href:t.href,className:"flex-1 px-4 py-3 rounded-lg text-center transition-colors ".concat(s?"bg-blue-600 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-600/50 hover:text-white"),children:[(0,r.jsx)("div",{className:"font-medium text-sm",children:t.label}),(0,r.jsx)("div",{className:"text-xs opacity-75",children:t.description})]},t.href)})})})})}}},e=>{e.O(0,[9535,6874,8337,8441,5964,7358],()=>e(e.s=5746)),_N_E=e.O()}]);