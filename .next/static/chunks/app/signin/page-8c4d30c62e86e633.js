(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4217],{1811:(e,t,r)=>{"use strict";r.d(t,{BP:()=>f,HK:()=>h,FX:()=>p,tB:()=>g,supabase:()=>w});var s=r(5647),a=r(9535),n=r(9509);let o="https://rggdywqnvpuwssluzfud.supabase.co",i="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZ2R5d3FudnB1d3NzbHV6ZnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzOTIwMTAsImV4cCI6MjA2OTk2ODAxMH0.j1AiBUEfjqVxLu8ARtH5B_DBKI1dg2EKgp_VZtprAzg";if(!o||!i)throw Error("Missing Supabase environment variables. Please ensure NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY are set.");let l=(0,a.createBrowserClient)(o,i),c=n.env.NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY||n.env.SUPABASE_SERVICE_ROLE_KEY;c&&(0,s.UU)(o,c,{auth:{autoRefreshToken:!1,persistSession:!1}});let d="delivery-dockets",u=new Map,m=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3600;if(arguments.length>2&&arguments[2],!e||""===e.trim()||"null"===e||"undefined"===e)return"";try{let r=e.split("/").pop()||e;console.log("\uD83D\uDD0D Generating signed URL for:",r),console.log("\uD83D\uDD0D Using bucket:",d),console.log("\uD83D\uDD0D Original path:",e);let{data:s,error:a}=await l.storage.from(d).list("",{limit:100});console.log("\uD83D\uDD0D Files in bucket:",(null==s?void 0:s.map(e=>e.name))||[]),console.log("\uD83D\uDD0D Looking for file:",r);let n=l.storage.from(d).createSignedUrl(r,t),{data:o,error:i}=await new Promise((e,t)=>{let r=setTimeout(()=>{t(Error("Timeout after ".concat(1e4,"ms")))},1e4);n.then(e).catch(t).finally(()=>clearTimeout(r))});if(i)return console.error("❌ Signed URL generation failed:",i),"";if(null==o?void 0:o.signedUrl)return console.log("✅ Signed URL generated:",o.signedUrl),o.signedUrl;return console.log("❌ No signed URL returned from Supabase"),""}catch(e){return console.error("❌ Signed URL exception:",e),""}},h=async(e,t)=>await m(e,3600,t),g=async(e,t)=>{let{data:r,error:s}=await l.from("client_users").select("role").eq("user_id",e).eq("client_id",t).eq("status","active").single();return s?(console.error("Error fetching user role:",s),null):(null==r?void 0:r.role)||null},p=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r="delivery-records-".concat(e,"-").concat(t);if(u.has(r))return u.get(r);let s=(async()=>{try{let r=new AbortController,s=setTimeout(()=>r.abort(),3e4),a=await fetch("/api/delivery-records?clientId=".concat(e,"&limit=").concat(t),{signal:r.signal});if(clearTimeout(s),!a.ok)throw Error("HTTP ".concat(a.status,": Failed to fetch delivery records"));let n=await a.json();if(!n.success)throw Error(n.error||"Failed to fetch delivery records");return n.data||[]}catch(t){return t instanceof Error&&"AbortError"===t.name?console.error("⏰ Delivery records request timed out for clientId:",e):console.error("❌ Error fetching delivery records for clientId:",e,t),[]}finally{u.delete(r)}})();return u.set(r,s),s},f=async e=>{let t="compliance-alerts-".concat(e);if(u.has(t))return u.get(t);let r=(async()=>{try{let t=new AbortController,r=setTimeout(()=>t.abort(),3e4),s=await fetch("/api/compliance-alerts?clientId=".concat(e),{signal:t.signal});if(clearTimeout(r),!s.ok)return console.warn("⚠️ Compliance alerts API not configured for demo mode"),[];let a=await s.json();if(!a.success)return[];return a.data||[]}catch(e){return e instanceof Error&&"AbortError"===e.name?console.warn("⏰ Compliance alerts request timed out"):console.warn("⚠️ Compliance alerts not available in demo mode"),[]}finally{u.delete(t)}})();return u.set(t,r),r};var x=r(9509);let b=null;try{let e="https://rggdywqnvpuwssluzfud.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZ2R5d3FudnB1d3NzbHV6ZnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzOTIwMTAsImV4cCI6MjA2OTk2ODAxMH0.j1AiBUEfjqVxLu8ARtH5B_DBKI1dg2EKgp_VZtprAzg",r=x.env.SUPABASE_SERVICE_ROLE_KEY;e&&t&&(b=(0,s.UU)(e,t,{auth:{persistSession:!0,autoRefreshToken:!0,storageKey:"hospitality-compliance-auth"}})),e&&r&&(0,s.UU)(e,r,{auth:{autoRefreshToken:!1,persistSession:!1}})}catch(e){console.warn("Supabase client initialization failed:",e instanceof Error?e.message:"Unknown error")}let w=b;console.log("\uD83D\uDE80 Database Core lib loaded - Modular Architecture v1.8.19")},3400:(e,t,r)=>{Promise.resolve().then(r.bind(r,8200))},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"redirect")&&r.d(t,{redirect:function(){return s.redirect}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},8200:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var s=r(5155),a=r(2115),n=r(5695),o=r(1811),i=r(6874),l=r.n(i),c=r(8337);let d=e=>{let{onPlatformChange:t,currentPlatform:r}=e;return null};function u(){let[e,t]=(0,a.useState)(!1),[r,i]=(0,a.useState)({email:"",password:""}),[u,m]=(0,a.useState)(""),[h,g]=(0,a.useState)("web");(0,n.useRouter)();let p=e=>{let{name:t,value:r}=e.target;i(e=>({...e,[t]:r}))},f=async e=>{e.preventDefault(),m(""),t(!0);try{let{data:e,error:s}=await o.supabase.auth.signInWithPassword({email:r.email,password:r.password});if(s){m(s.message),t(!1);return}e.user?(console.log("✅ Sign in successful, redirecting..."),t(!1),setTimeout(()=>{let e=new URLSearchParams(window.location.search).get("redirectTo")||"/console/dashboard";console.log("\uD83D\uDD04 Redirecting to:",e),window.location.replace(e)},100)):(console.log("❌ No user returned from sign in"),m("Sign in failed - please try again"),t(!1))}catch(e){m("An unexpected error occurred. Please try again."),t(!1)}finally{setTimeout(()=>{t(!1)},5e3)}};return(0,s.jsxs)("div",{className:"min-h-screen relative overflow-hidden Platform".concat(h.charAt(0).toUpperCase()).concat(h.slice(1)),children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('/chef-workspace.jpg')",filter:"brightness(0.6)"}}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/30"}),(0,s.jsx)("header",{className:"absolute top-0 left-0 right-0 z-20",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-24",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-12 h-12",children:(0,s.jsx)("img",{src:"/JiGR_Logo-full_figma_circle.png",alt:"JiGR Logo",className:"w-12 h-12 object-contain"})}),(0,s.jsx)("span",{className:"text-white font-bold text-2xl",children:"Hospitality Compliance"})]})})})}),(0,s.jsx)("div",{className:"relative z-10 min-h-screen flex items-center justify-center px-4 pt-40",children:(0,s.jsxs)("div",{className:"".concat((0,c.ed)("primary")," max-w-md w-full mx-auto"),children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"".concat((0,c.$$)("pageTitle")," mb-2 tracking-tight"),children:"Welcome Back"}),(0,s.jsx)("p",{className:"".concat((0,c.$$)("bodySmall")," font-light"),children:"Sign in to your compliance dashboard"})]}),(0,s.jsxs)("form",{onSubmit:f,className:"space-y-5",children:[(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"email",name:"email",placeholder:"Email Address",value:r.email,onChange:p,required:!0,className:(0,c._c)()})}),(0,s.jsx)("div",{children:(0,s.jsx)("input",{type:"password",name:"password",placeholder:"Password",value:r.password,onChange:p,required:!0,className:(0,c._c)()})}),u&&(0,s.jsx)("div",{className:"bg-red-500/20 border border-red-400/30 rounded-xl p-3",children:(0,s.jsx)("p",{className:"text-red-200 text-sm text-center",children:u})}),(0,s.jsx)("button",{type:"submit",disabled:e,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white font-semibold py-3 px-6 rounded-xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-[1.02] disabled:transform-none mb-4",children:e?(0,s.jsxs)("div",{className:"flex items-center justify-center",children:[(0,s.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-white border-t-transparent rounded-full mr-2"}),"Signing In..."]}):"Sign In"})]}),(0,s.jsxs)("div",{className:"text-center mt-6 space-y-3",children:[(0,s.jsx)(l(),{href:"/forgot-password",className:"block text-blue-300 hover:text-blue-200 text-sm font-medium transition-colors duration-200",children:"Forgot your password?"}),(0,s.jsxs)("p",{className:"".concat((0,c.$$)("body")," ").concat(c.Bg.colors.text.onGlassSecondary),children:["Don't have an account?"," ",(0,s.jsx)(l(),{href:"/create-account",className:"text-blue-300 hover:text-blue-200 font-semibold transition-colors duration-200",children:"Sign Up"})]})]}),(0,s.jsx)("div",{className:"text-center mt-6 pt-4 border-t border-white/10",children:(0,s.jsx)("p",{className:"text-xs font-medium text-white/90",children:"v1.8.18a"})}),(0,s.jsx)(d,{currentPlatform:h,onPlatformChange:g})]})})]})}}},e=>{e.O(0,[9535,6874,8337,8441,5964,7358],()=>e(e.s=3400)),_N_E=e.O()}]);