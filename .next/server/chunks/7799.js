"use strict";exports.id=7799,exports.ids=[7799],exports.modules={67799:(a,b,c)=>{c.d(b,{A:()=>i});var d=c(60687),e=c(43210);class f{async preprocessForQualityAnalysis(a,b){let c=performance.now(),d={...this.defaultOptions,...b},e=a.size;if(!this.isSupportedByBrowser(a))return console.warn(`Unsupported format: ${a.type} (${a.name}). Browser cannot process HEIC/HEIF files.`),{processedFile:a,originalSize:e,processedSize:a.size,compressionRatio:1,resized:!1,converted:!1,processingTime:performance.now()-c};if(a.size<=d.maxFileSize&&this.isOptimalFormat(a))return{processedFile:a,originalSize:e,processedSize:a.size,compressionRatio:1,resized:!1,converted:!1,processingTime:performance.now()-c};try{let b=await this.processImage(a,d),f=performance.now()-c;return{processedFile:b,originalSize:e,processedSize:b.size,compressionRatio:e/b.size,resized:await this.wasResized(a,b),converted:a.type!==b.type,processingTime:f}}catch(b){return console.error("Image preprocessing failed:",b),{processedFile:a,originalSize:e,processedSize:a.size,compressionRatio:1,resized:!1,converted:!1,processingTime:performance.now()-c}}}async processImage(a,b){return new Promise((c,d)=>{let e=new Image,f=document.createElement("canvas"),g=f.getContext("2d");if(!g)return void d(Error("Could not get canvas context"));e.onload=()=>{try{let{width:h,height:i}=this.calculateOptimalDimensions(e.width,e.height,b.maxWidth,b.maxHeight);f.width=h,f.height=i,g.imageSmoothingEnabled=!0,g.imageSmoothingQuality="high",g.drawImage(e,0,0,h,i),f.toBlob(e=>{if(e){let d=new File([e],this.generateFileName(a,b.targetFormat),{type:`image/${b.targetFormat}`,lastModified:Date.now()});c(d)}else d(Error("Failed to create processed image blob"))},`image/${b.targetFormat}`,b.quality)}catch(a){d(a)}finally{URL.revokeObjectURL(e.src)}},e.onerror=a=>{URL.revokeObjectURL(e.src),d(Error("Failed to load image for processing"))},e.src=URL.createObjectURL(a)})}calculateOptimalDimensions(a,b,c,d){if(a<=c&&b<=d)return{width:a,height:b};let e=a/b,f=c,g=c/e;return g>d&&(g=d,f=d*e),{width:Math.round(f),height:Math.round(g)}}generateFileName(a,b){let c=a.name.replace(/\.[^/.]+$/,""),d=Date.now();return`${c}_processed_${d}.${b}`}isOptimalFormat(a){return["image/jpeg","image/jpg","image/png","image/webp"].includes(a.type.toLowerCase())}isSupportedByBrowser(a){return!["image/heic","image/heif"].includes(a.type.toLowerCase())&&!a.name.toLowerCase().endsWith(".heic")&&!a.name.toLowerCase().endsWith(".heif")}async wasResized(a,b){return b.size/a.size<.8}static formatFileSize(a){if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(2))+" "+["Bytes","KB","MB","GB"][b]}static estimateProcessingTime(a){return a<1048576?1e3:a<5242880?3e3:a<0xa00000?6e3:1e4}constructor(){this.defaultOptions={maxWidth:2048,maxHeight:2048,maxFileSize:5242880,quality:.85,targetFormat:"jpeg"}}}class g{async validateForOCR(a){try{let b,c=a;if((a.size>0xa00000||!this.isOptimalFormat(a))&&(console.log(`Preprocessing ${a.name} (${f.formatFileSize(a.size)})`),c=(b=await this.preprocessor.preprocessForQualityAnalysis(a,{maxWidth:1920,maxHeight:1920,maxFileSize:5242880,quality:.85,targetFormat:"jpeg"})).processedFile,b.processedFile===a?console.log("File format not supported for preprocessing, analyzing original file"):console.log(`Preprocessed to ${f.formatFileSize(c.size)} in ${b.processingTime.toFixed(0)}ms`)),!this.isSupportedByBrowser(c)){console.log(`Cannot analyze ${c.name} - unsupported format for quality analysis`);let d={brightness:50,contrast:50,sharpness:50,resolution:3e6,fileSize:a.size,aspectRatio:1.33},e=this.generateSuggestions(d,b,a),f=this.generateWarnings(d,b,a);return{acceptable:!0,score:50,metrics:d,suggestions:e,warnings:f,preprocessing:b}}let d=new Promise((a,b)=>{setTimeout(()=>b(Error("Quality analysis timeout")),8e3)}),e=await Promise.race([this.calculateMetrics(c),d]);b&&(e.fileSize=a.size);let g=this.generateSuggestions(e,b,a),h=this.generateWarnings(e,b,a),i=this.isAcceptableForOCR(e),j=this.calculateQualityScore(e);return{acceptable:i,score:j,metrics:e,suggestions:g,warnings:h,preprocessing:b}}catch(b){return console.error("Quality validation failed:",b),{acceptable:!0,score:50,metrics:{brightness:50,contrast:50,sharpness:50,resolution:0,fileSize:a.size,aspectRatio:1},suggestions:["Quality analysis failed - using fallback validation"],warnings:["Could not analyze image quality"]}}}async calculateMetrics(a){return new Promise((b,c)=>{let d=new Image,e=document.createElement("canvas"),f=e.getContext("2d");if(!f)return void c(Error("Could not get canvas context"));d.onload=()=>{try{e.width=d.width,e.height=d.height,f.drawImage(d,0,0);let c=f.getImageData(0,0,e.width,e.height);b({brightness:this.calculateBrightness(c),contrast:this.calculateContrast(c),sharpness:this.calculateSharpness(c),resolution:d.width*d.height,fileSize:a.size,aspectRatio:d.width/d.height})}catch(a){console.error("Error processing image:",a),c(a)}finally{URL.revokeObjectURL(d.src)}},d.onerror=a=>{console.error("Error loading image:",a),URL.revokeObjectURL(d.src),c(Error("Failed to load image"))},d.src=URL.createObjectURL(a)})}calculateBrightness(a){let b=a.data,c=0;for(let a=0;a<b.length;a+=4){let d=b[a];c+=(d+b[a+1]+b[a+2])/3}return c/(b.length/4)/255*100}calculateContrast(a){let b=a.data,c=255*this.calculateBrightness(a)/100,d=0,e=b.length/4;for(let a=0;a<b.length;a+=4){let e=b[a];d+=Math.pow((e+b[a+1]+b[a+2])/3-c,2)}return Math.min(Math.sqrt(d/e)/255*100,100)}calculateSharpness(a){let b=a.data,c=a.width,d=a.height,e=0,f=0,g=Math.max(1,Math.floor(Math.min(c,d)/100));for(let a=g;a<d-g;a+=g)for(let d=g;d<c-g;d+=g){let g=(a*c+d)*4,h=b[g],i=b[g+4];e+=Math.abs(h-i)+Math.abs(h-b[g+4*c]),f++}return 0===f?50:Math.min(e/f/255*100,100)}isOptimalFormat(a){return["image/jpeg","image/jpg","image/png","image/webp"].includes(a.type.toLowerCase())}isSupportedByBrowser(a){let b=["image/heic","image/heif"].includes(a.type.toLowerCase()),c=a.name.toLowerCase().endsWith(".heic")||a.name.toLowerCase().endsWith(".heif");return!b&&!c}isAcceptableForOCR(a){return a.brightness>=this.thresholds.brightness.min&&a.brightness<=this.thresholds.brightness.max&&a.contrast>=this.thresholds.contrast.min&&a.sharpness>=this.thresholds.sharpness.min&&a.resolution>=this.thresholds.resolution.min&&a.fileSize>=this.thresholds.fileSize.min&&a.fileSize<=this.thresholds.fileSize.max&&a.aspectRatio>=this.thresholds.aspectRatio.min&&a.aspectRatio<=this.thresholds.aspectRatio.max}calculateQualityScore(a){let b=0;return a.brightness>=40&&a.brightness<=80?b+=30:a.brightness>=30&&a.brightness<=85?b+=20:a.brightness>=20&&a.brightness<=90&&(b+=10),a.contrast>=40?b+=25:a.contrast>=25?b+=15:a.contrast>=15&&(b+=10),a.sharpness>=50?b+=25:a.sharpness>=35?b+=15:a.sharpness>=20&&(b+=10),a.resolution>=2073600?b+=20:a.resolution>=96e4?b+=15:a.resolution>=48e4&&(b+=10),Math.round(b)}generateSuggestions(a,b,c){let d=[];return b&&(b.processedFile===c&&c&&c.name.toLowerCase().includes(".heic")?(d.push("HEIC format detected - browser cannot process this format for quality analysis"),d.push("Consider converting to JPEG/PNG format for detailed quality feedback"),d.push("File will still be uploaded for OCR processing")):b.converted&&d.push(`Converted from ${c?.type||"original format"} to JPEG for better compatibility`),b.resized&&d.push(`Resized image for faster processing (${b.compressionRatio.toFixed(1)}x smaller)`),b.processingTime>3e3&&d.push("Large file detected - consider capturing smaller images for faster analysis")),a.brightness<30?d.push("Improve lighting - image is too dark for optimal OCR"):a.brightness>85&&d.push("Reduce lighting - image is too bright, may cause glare"),a.contrast<25&&d.push("Increase contrast between text and background"),a.sharpness<35&&d.push("Hold camera steady and ensure document is in focus"),a.resolution<96e4&&d.push("Move closer to document or use higher camera resolution"),a.fileSize<102400?d.push("Image quality too low - try capturing again"):a.fileSize>0x3200000?d.push("Very large file - consider using camera settings with lower resolution"):a.fileSize>0x1400000&&d.push("Large file size may slow down processing"),(a.aspectRatio<.5||a.aspectRatio>2)&&d.push("Document appears distorted - ensure proper framing"),d}generateWarnings(a,b,c){let d=[];return b&&(b.processedFile===c&&c&&c.name.toLowerCase().includes(".heic")&&d.push("HEIC format cannot be analyzed for quality - quality metrics are estimates"),b.compressionRatio>10&&d.push("Image was heavily compressed - some quality may be lost"),b.processingTime>5e3&&d.push("Large file required significant processing time")),(a.brightness<20||a.brightness>90)&&d.push("Extreme brightness levels may prevent text recognition"),a.contrast<15&&d.push("Very low contrast - text may be unreadable"),a.sharpness<20&&d.push("Image appears blurry - OCR accuracy will be poor"),a.resolution<48e4&&d.push("Resolution too low for reliable text extraction"),a.fileSize>0x6400000&&d.push("Extremely large file - may cause memory issues"),d}constructor(){this.preprocessor=new f,this.thresholds={brightness:{min:30,max:85},contrast:{min:25},sharpness:{min:35},resolution:{min:96e4},fileSize:{min:102400,max:8388608},aspectRatio:{min:.5,max:2}}}}function h({qualityReport:a,isProcessing:b}){var c,e;return b?(0,d.jsx)("div",{className:"bg-blue-500/20 border border-blue-400/30 rounded-xl p-4",children:(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-blue-400 border-t-transparent rounded-full"}),(0,d.jsx)("p",{className:"text-blue-200 text-sm font-medium",children:"Analyzing image quality..."})]})}):a?(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:`rounded-xl p-4 border ${(c=a.score)>=80?"bg-green-500/20 border-green-400/30":c>=60?"bg-yellow-500/20 border-yellow-400/30":"bg-red-500/20 border-red-400/30"}`,children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsx)("span",{className:"text-white text-sm font-medium",children:"Image Quality"}),(0,d.jsxs)("span",{className:`text-lg font-bold ${(e=a.score)>=80?"text-green-400":e>=60?"text-yellow-400":"text-red-400"}`,children:[a.score,"%"]})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Brightness:"}),(0,d.jsxs)("span",{className:a.metrics.brightness>=30&&a.metrics.brightness<=85?"text-green-400":"text-yellow-400",children:[Math.round(a.metrics.brightness),"%"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Contrast:"}),(0,d.jsxs)("span",{className:a.metrics.contrast>=25?"text-green-400":"text-yellow-400",children:[Math.round(a.metrics.contrast),"%"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Sharpness:"}),(0,d.jsxs)("span",{className:a.metrics.sharpness>=35?"text-green-400":"text-yellow-400",children:[Math.round(a.metrics.sharpness),"%"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Resolution:"}),(0,d.jsx)("span",{className:a.metrics.resolution>=96e4?"text-green-400":"text-yellow-400",children:a.metrics.resolution>=1e6?`${(a.metrics.resolution/1e6).toFixed(1)}MP`:`${Math.round(a.metrics.resolution/1e3)}K`})]})]})]}),a.preprocessing&&(0,d.jsxs)("div",{className:"bg-purple-500/20 border border-purple-400/30 rounded-xl p-4",children:[(0,d.jsx)("h4",{className:"text-purple-300 text-sm font-medium mb-2",children:"⚡ Processing Info:"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Original Size:"}),(0,d.jsxs)("span",{className:"text-purple-300",children:[(a.preprocessing.originalSize/1024/1024).toFixed(1)," MB"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Processed Size:"}),(0,d.jsxs)("span",{className:"text-purple-300",children:[(a.preprocessing.processedSize/1024/1024).toFixed(1)," MB"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Compression:"}),(0,d.jsxs)("span",{className:"text-purple-300",children:[a.preprocessing.compressionRatio.toFixed(1),"x"]})]}),(0,d.jsxs)("div",{className:"flex justify-between",children:[(0,d.jsx)("span",{className:"text-white/70",children:"Process Time:"}),(0,d.jsxs)("span",{className:"text-purple-300",children:[a.preprocessing.processingTime.toFixed(0),"ms"]})]})]})]}),a.suggestions.length>0&&(0,d.jsxs)("div",{className:"bg-blue-500/20 border border-blue-400/30 rounded-xl p-4",children:[(0,d.jsx)("h4",{className:"text-blue-300 text-sm font-medium mb-2",children:"\uD83D\uDCA1 Improvement Tips:"}),(0,d.jsx)("ul",{className:"space-y-1",children:a.suggestions.map((a,b)=>(0,d.jsxs)("li",{className:"text-blue-200 text-xs flex items-start space-x-2",children:[(0,d.jsx)("span",{className:"text-blue-400 mt-1",children:"•"}),(0,d.jsx)("span",{children:a})]},b))})]}),a.warnings.length>0&&(0,d.jsxs)("div",{className:"bg-red-500/20 border border-red-400/30 rounded-xl p-4",children:[(0,d.jsx)("h4",{className:"text-red-300 text-sm font-medium mb-2",children:"⚠️ Quality Warnings:"}),(0,d.jsx)("ul",{className:"space-y-1",children:a.warnings.map((a,b)=>(0,d.jsxs)("li",{className:"text-red-200 text-xs flex items-start space-x-2",children:[(0,d.jsx)("span",{className:"text-red-400 mt-1",children:"•"}),(0,d.jsx)("span",{children:a})]},b))})]}),(0,d.jsx)("div",{className:`rounded-xl p-3 border ${a.acceptable?"bg-green-500/20 border-green-400/30":"bg-yellow-500/20 border-yellow-400/30"}`,children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("span",{className:a.acceptable?"text-green-400":"text-yellow-400",children:a.acceptable?"✅":"⚠️"}),(0,d.jsx)("span",{className:`text-sm font-medium ${a.acceptable?"text-green-300":"text-yellow-300"}`,children:a.acceptable?"Ready for OCR Processing":"May have OCR accuracy issues"})]})})]}):null}function i({onFileValidated:a,onFileRejected:b,allowPoorQuality:c=!1,className:f="",children:i}){let[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(null),[n,o]=(0,e.useState)(null),p=(0,e.useRef)(null),q=(0,e.useMemo)(()=>new g,[]),r=(0,e.useCallback)(async d=>{if(!d.type.startsWith("image/"))return void alert("Please select an image file");o(d),k(!0),m(null);try{let e=await q.validateForOCR(d);m(e),e.acceptable||c?a(d,e):b(d,e)}catch(c){console.error("Quality validation failed:",c);let b={acceptable:!0,score:50,metrics:{brightness:50,contrast:50,sharpness:50,resolution:0,fileSize:d.size,aspectRatio:1},suggestions:["Quality validation failed - using fallback"],warnings:[]};m(b),a(d,b)}finally{k(!1)}},[q,a,b,c]),s=()=>{p.current?.click()},t=()=>{o(null),m(null),s()};return(0,d.jsxs)("div",{className:`space-y-4 ${f}`,children:[(0,d.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:a=>{let b=a.target.files?.[0];b&&r(b)},className:"hidden"}),(0,d.jsx)("div",{onDrop:a=>{a.preventDefault();let b=a.dataTransfer.files[0];b&&r(b)},onDragOver:a=>{a.preventDefault()},onClick:s,className:"relative overflow-hidden p-8 rounded-3xl border-2 border-dashed border-white/30 hover:border-white/50 cursor-pointer transition-all duration-300 bg-white/5 hover:bg-white/10",children:i||(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"mb-4",children:(0,d.jsx)("svg",{className:"mx-auto h-12 w-12 text-white/50",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:(0,d.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,d.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Drop your image here or click to browse"}),(0,d.jsx)("p",{className:"text-sm text-white/70",children:"Supports JPG, PNG, WebP • Max 8MB"}),(0,d.jsx)("p",{className:"text-xs text-white/50 mt-2",children:"Images will be analyzed for OCR quality"})]})}),n&&(0,d.jsx)("div",{className:"bg-white/10 border border-white/20 rounded-xl p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,d.jsx)("div",{className:"bg-blue-500/20 p-2 rounded-lg",children:(0,d.jsx)("svg",{className:"h-5 w-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-white text-sm font-medium",children:n.name}),(0,d.jsxs)("p",{className:"text-white/60 text-xs",children:[(n.size/1024/1024).toFixed(2)," MB"]})]})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("button",{onClick:()=>{n&&r(n)},disabled:j,className:"px-3 py-1 bg-blue-500/20 text-blue-300 text-xs rounded-lg hover:bg-blue-500/30 transition-colors disabled:opacity-50",children:"Reanalyze"}),(0,d.jsx)("button",{onClick:t,className:"px-3 py-1 bg-gray-500/20 text-gray-300 text-xs rounded-lg hover:bg-gray-500/30 transition-colors",children:"New File"})]})]})}),(0,d.jsx)(h,{qualityReport:l,isProcessing:j}),l&&!l.acceptable&&!c&&(0,d.jsx)("div",{className:"bg-yellow-500/20 border border-yellow-400/30 rounded-xl p-4",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-yellow-300 text-sm font-medium",children:"Quality Below OCR Standards"}),(0,d.jsx)("p",{className:"text-yellow-200 text-xs",children:"This image may produce poor OCR results. Consider retaking for better accuracy."})]}),(0,d.jsxs)("div",{className:"flex space-x-2",children:[(0,d.jsx)("button",{onClick:()=>n&&a(n,l),className:"px-4 py-2 bg-yellow-500/30 text-yellow-200 text-sm rounded-lg hover:bg-yellow-500/40 transition-colors",children:"Use Anyway"}),(0,d.jsx)("button",{onClick:t,className:"px-4 py-2 bg-green-500/30 text-green-200 text-sm rounded-lg hover:bg-green-500/40 transition-colors",children:"Try Again"})]})]})})]})}}};