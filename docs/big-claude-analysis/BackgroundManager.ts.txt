'use client'

import { useEffect } from 'react'
import { usePathname } from 'next/navigation'
// import { getStorageImageUrl, STORAGE_BUCKETS } from './image-storage'
// Note: This file is a copy for Big Claude analysis - imports removed for reference only

// Module background mapping - Order matters! More specific paths first
const MODULE_BACKGROUNDS: Record<string, string> = {
  '/admin': 'backgrounds/Home-Chef-Chicago-8.webp',
  '/upload': 'backgrounds/chef-workspace.jpg',
  '/dashboard': 'backgrounds/kitchen-prep.jpg',
  '/login': 'backgrounds/CafeWindow.jpg',
  '/register': 'backgrounds/CafeWindow.jpg',
  // Add more as needed
}

// Exact path matches for public pages
const EXACT_PATH_BACKGROUNDS: Record<string, string> = {
  '/': 'backgrounds/restaurant.jpg', // Landing page only
}

// Default fallback
const DEFAULT_BACKGROUND = 'backgrounds/chef-workspace.jpg'

export function useModuleBackground() {
  const pathname = usePathname()
  
  useEffect(() => {
    // Check exact matches first
    let backgroundPath = EXACT_PATH_BACKGROUNDS[pathname]
    
    // If no exact match, check module prefixes
    if (!backgroundPath) {
      const moduleKey = Object.keys(MODULE_BACKGROUNDS).find(key => 
        pathname.startsWith(key)
      )
      backgroundPath = moduleKey ? MODULE_BACKGROUNDS[moduleKey] : DEFAULT_BACKGROUND
    }
    
    // Debug logging
    console.log('ðŸŽ¨ BackgroundManager:', {
      pathname,
      backgroundPath,
      exact: !!EXACT_PATH_BACKGROUNDS[pathname]
    })
    
    const backgroundUrl = getStorageImageUrl(
      STORAGE_BUCKETS.MODULE_ASSETS,
      backgroundPath,
      {
        format: 'webp',
        quality: 75,
        width: 1920,
        height: 1080
      }
    )
    
    console.log('ðŸŽ¨ Generated background URL:', backgroundUrl)
    
    // Remove existing background div if any
    const existingDiv = document.getElementById('dynamic-background')
    if (existingDiv) {
      existingDiv.remove()
    }
    
    // Create a single fixed background div with high z-index
    const bgDiv = document.createElement('div')
    bgDiv.id = 'dynamic-background'
    bgDiv.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-image: url(${backgroundUrl});
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: -1;
      pointer-events: none;
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
    `
    
    // Insert at beginning of body
    document.body.insertBefore(bgDiv, document.body.firstChild)
    
    console.log('ðŸŽ¨ Created background div with URL:', backgroundUrl)
    
    // Cleanup on unmount
    return () => {
      const bgDiv = document.getElementById('dynamic-background')
      if (bgDiv) {
        bgDiv.remove()
      }
    }
  }, [pathname])
}